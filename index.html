<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÿ¥ÿ±ŸÉÿ© ÿßŸÑÿ™ŸàÿßÿµŸÑ ÿßŸÑÿπÿßŸÑŸÖŸä - ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿßÿ≥ÿ™ÿ±ÿßÿ™Ÿäÿ¨Ÿä ŸÑÿ£ÿ≥ÿπÿßÿ± ŸÅŸÜÿßÿØŸÇ ÿßŸÑÿπŸÖÿ±ÿ© 1447ŸáŸÄ</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìä</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Removed export-related libraries: html2canvas, jspdf, xlsx, jszip, FileSaver -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/moment@2.30.1/min/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment-hijri@2.1.2/build/moment-hijri.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hijri-date/dist/hijri-date.js"></script>
    <style>
        :root {
            /* Brand palette derived from provided logos (gold / dark brown) */
            --brand-gold: #b8862f; /* primary gold */
            --brand-gold-light: #d4af37;
            --brand-dark: #3a2d1f; /* Deeper brown for text */
            --brand-background: #fdfcf9; /* Softer, warmer background */
            --brand-card-bg: #ffffff;
            --brand-accent: #8c6c2f;
            --brand-muted-text: #6e6051;
            --brand-muted: #f7f6f4; /* fallback muted background */
        }

        /* Base typography & layout */
        html, body {
            height: 100%;
            font-family: 'Cairo', sans-serif;
            scroll-behavior: smooth;
            background-color: var(--brand-background);
            color: var(--brand-dark);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Cards */
        .section-card {
            background-color: var(--brand-card-bg);
            border-radius: 1rem;
            padding: 2.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.04);
            border: 1px solid #e5e7eb;
            transition: transform 0.25s ease, box-shadow 0.25s ease;
        }
        .section-card:hover { transform: translateY(-6px); box-shadow: 0 18px 24px -8px rgba(58,45,31,0.08); }

        h1, h2, h3 { color: var(--brand-dark); line-height: 1.15; }

        /* Chart container responsive sizing */
        .chart-container {
            position: relative;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
            height: min(46vh, 420px);
            max-width: 900px;
        }

        /* Header / nav styles */
        .brand-logo { height: 72px; width: auto; }
        .sticky-nav { position: sticky; top: 0; z-index: 60; backdrop-filter: blur(6px); }

        /* ToTop button (RTL left) */
        #toTopBtn { position: fixed; bottom: 20px; left: 20px; display: none; z-index: 100; transition: opacity 0.3s, transform 0.3s; opacity: 0; transform: translateY(10px); }
        #toTopBtn.show { display: block; opacity: 1; transform: translateY(0); }

        /* Dropdown exports */
        .dropdown { position: relative; display: inline-block; }
        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;      /* align below the button */
            right: 0;
            background-color: #fff;
            min-width: 220px;
            margin-top: 0.25rem;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            z-index: 120;
            border-radius: 0.5rem;
        }
        .dropdown-content a { color: var(--brand-dark); padding: 12px 16px; text-decoration: none; display: block; text-align: right; transition: background-color 0.18s, color 0.18s; }
        .dropdown-content a:hover { background-color: var(--brand-dark); color: var(--brand-gold); }
    .dropdown:hover .dropdown-content { display: block; }
    /* show dropdown on click for touch devices */
    .dropdown-content.show { display: block !important; }

        /* NAV responsive behavior: mobile toggle + animated panel */
        #navToggle { display: inline-flex; align-items: center; justify-content: center; background: transparent; border: none; cursor: pointer; }
        #navLinks { display: flex; gap: 1.5rem; align-items: center; }

        /* Mobile-specific: collapse nav links into full-width sliding panel */
        @media (max-width: 767px) {
            .brand-logo { height: 56px; }
            header h1 { font-size: clamp(1.25rem, 4vw, 2rem); }
            .section-card { padding: 1.25rem; }
            .chart-container { height: 34vh; max-width: 100%; }

            /* The panel becomes a vertical, sliding dropdown below the nav */
            #navLinks {
                position: absolute;
                right: 0;
                left: 0;
                top: 100%;
                background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.995));
                flex-direction: column;
                gap: 0;
                align-items: stretch;
                padding: 0.5rem 0.75rem;
                border-top: 1px solid rgba(0,0,0,0.04);
                overflow: visible; /* allow dropdowns to overflow */
                max-height: 0; /* collapsed */
                opacity: 0;
                transform-origin: top right;
                transform: translateY(-6px);
                transition: max-height 320ms cubic-bezier(.2,.9,.2,1), opacity 220ms ease, transform 260ms cubic-bezier(.2,.9,.2,1);
                z-index: 70;
            }
            #navLinks a { padding: 0.75rem 1rem; border-radius: 0.5rem; color: var(--brand-dark); }
            #navLinks .dropdown { margin: 0.5rem 1rem; }
            #navLinks.show { max-height: 420px; opacity: 1; transform: translateY(0); }

            /* Slight padding on container for mobile */
            .sticky-nav .container { padding-left: 0.75rem; padding-right: 0.75rem; }
        }

        /* Tablet and up: comfortable spacing */
        @media (min-width: 768px) and (max-width: 1023px) {
            .chart-container { height: 38vh; max-width: 780px; }
            .brand-logo { height: 64px; }
            .section-card { padding: 1.5rem; }
        }

        /* Desktop large screens */
        @media (min-width: 1024px) {
            .chart-container { height: 46vh; max-width: 1100px; }
            .brand-logo { height: 80px; }
            .section-card { padding: 2.5rem; }
        }

        /* Small visual refinements */
        .sticky-nav a:hover { color: var(--brand-gold); }
        .sticky-nav .dropdown button { background-color: var(--brand-dark) !important; }
        .sticky-nav .dropdown button:hover { background-color: var(--brand-accent) !important; }

        /* ÿßÿ≥ÿ™ÿ®ÿØÿßŸÑ @apply ÿ®ÿ™ŸÜÿ≥ŸäŸÇ ÿ´ÿßÿ®ÿ™ ŸÑÿ£ŸÜ CDN ŸÑÿß ŸäÿØÿπŸÖ @apply */
        .cal-mode-btn {
            padding:0.45rem 0.8rem;
            font-size:11px;
            font-weight:600;
            border:1px solid #d1d5db;
            background:#fff;
            border-radius:0.5rem;
            cursor:pointer;
            line-height:1;
            display:inline-flex;
            align-items:center;
            gap:.35rem;
            transition:.18s background-color,.18s color,.18s border-color,.18s box-shadow;
        }
        .cal-mode-btn:hover { background:#f3f4f6; }
        .cal-mode-btn.active {
            background:var(--brand-gold);
            color:#fff;
            border-color:var(--brand-gold);
            box-shadow:0 0 0 1px var(--brand-gold-light) inset;
        }
        .hijri-warning {
            font-size:11px;
            color:#b45309;
            background:#fff7ed;
            border:1px solid #fcd9b6;
            padding:.4rem .6rem;
            border-radius:.5rem;
            display:none;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Palette: Brilliant Blues -->
    <!-- #005f73, #0a9396, #94d2bd, #e9d8a6, #ee9b00, #ca6702, #bb3e03, #ae2012, #9b2226 -->
    <!-- Confirmation: NEITHER Mermaid JS NOR SVG were used in this output. -->
    <!-- 
        Narrative Plan:
        1.  Introduction: Set the stage for the 1447H Umrah hotel market analysis.
        2.  Makkah Market: Analyze premium and budget hotel costs, price evolution, and meal plan composition.
        3.  Madinah Market: Compare key hotels on price and analyze value using a scatter plot.
        4.  Supplier Analysis: Compare prices from different suppliers for the same hotel.
        5.  Seasonal Peaks: Highlight price surges during peak periods for both cities.
        6.  Key Insights: Provide expanded, actionable takeaways and pricing advice.
        
        Visualization Choices:
        -   Makkah Premium Hotel Costs -> Bar Chart (Goal: Compare) -> Implemented with Chart.js.
        -   Makkah Budget Hotel Costs -> Bar Chart (Goal: Compare) -> Implemented with Chart.js.
        -   Makkah Price Evolution -> Line Chart (Goal: Show Change) -> Implemented with Chart.js.
        -   Makkah Meal Plan Composition -> Doughnut Chart (Goal: Show Composition) -> Implemented with Chart.js.
        -   Madinah Hotel Costs -> Bar Chart (Goal: Compare) -> Implemented with Chart.js.
        -   Madinah Value Analysis -> Scatter Plot (Goal: Reveal Relationships) -> Implemented with Chart.js.
        -   Supplier Price Comparison -> Grouped Bar Chart (Goal: Compare) -> Implemented with Chart.js.
        -   Seasonal Peaks -> Styled List (Goal: Organize/Inform) -> Implemented with HTML/Tailwind.
        -   Key Takeaways -> Styled List (Goal: Organize/Inform) -> Implemented with HTML/Tailwind.
    -->

    <nav class="sticky-nav bg-[var(--brand-card-bg)]/80 backdrop-blur-md shadow-md">
        <div class="container mx-auto px-4">
            <div class="flex justify-center items-center h-24"> <!-- Increased height -->
                <div class="flex items-center gap-4">
                    <img src="./logo1.png" alt="ÿ¥ÿπÿßÿ± ÿ¥ÿ±ŸÉÿ© ÿßŸÑÿ™ŸàÿßÿµŸÑ ÿßŸÑÿπÿßŸÑŸÖŸä" class="brand-logo h-16"> <!-- Adjusted size -->
                    <div>
                        <h1 class="text-2xl font-extrabold" style="color: var(--brand-dark);">ÿ¥ÿ±ŸÉÿ© ÿßŸÑÿ™ŸàÿßÿµŸÑ ÿßŸÑÿπÿßŸÑŸÖŸä</h1>
                        <p class="text-xs" style="color: var(--brand-muted-text);">ŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿ£ÿ≥ÿπÿßÿ± ÿßŸÑŸÅŸÜÿßÿØŸÇ</p>
                    </div>
                </div>
                <div class="flex-grow"></div>
                <!-- Desktop links (hidden on mobile) -->
                <div id="navLinks" class="flex items-center space-x-6">
                    <a href="#makkah" class="text-gray-600 hover:text-[var(--brand-gold)] font-semibold transition">ÿ™ÿ≠ŸÑŸäŸÑ ŸÖŸÉÿ©</a>
                    <a href="#madinah" class="text-gray-600 hover:text-[var(--brand-gold)] font-semibold transition">ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖÿØŸäŸÜÿ©</a>
                    <a href="#suppliers" class="text-gray-600 hover:text-[var(--brand-gold)] font-semibold transition">ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜ</a>
                    <a href="#peaks" class="text-gray-600 hover:text-[var(--brand-gold)] font-semibold transition">ŸÅÿ™ÿ±ÿßÿ™ ÿßŸÑÿ∞ÿ±Ÿàÿ©</a>
                    <a href="#takeaways" class="text-gray-600 hover:text-[var(--brand-gold)] font-semibold transition">ÿßŸÑÿ™ŸàÿµŸäÿßÿ™ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©</a>
                    <!-- Export Button Dropdown -->
                    <div class="dropdown">
                        <button class="text-white font-bold py-2 px-4 rounded-lg transition inline-flex items-center" style="background:var(--brand-dark);">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                            <span>ÿ™ŸÜÿ≤ŸäŸÑ ÿßŸÑŸÖŸÑŸÅÿßÿ™</span>
                        </button>
                        <div class="dropdown-content">
                            <a href="/ÿßÿ≥ÿπÿßÿ± ŸÅŸÜÿßÿØŸÇ ÿßŸÑŸÖÿØŸäŸÜÿ© ÿßŸÑŸÖŸÜŸàÿ±ÿ© 1447ŸáŸÄ.xlsx" download>ÿßÿ≥ÿπÿßÿ± ŸÅŸÜÿßÿØŸÇ ÿßŸÑŸÖÿØŸäŸÜÿ© ÿßŸÑŸÖŸÜŸàÿ±ÿ© 1447ŸáŸÄ Excel</a>
                            <a href="/ÿßÿ≥ÿπÿßÿ± ŸÅŸÜÿßÿØŸÇ ŸÖŸÉÿ© ÿßŸÑŸÖŸÉÿ±ŸÖÿ© 1447ŸáŸÄ.xlsx" download>ÿßÿ≥ÿπÿßÿ± ŸÅŸÜÿßÿØŸÇ ŸÖŸÉÿ© ÿßŸÑŸÖŸÉÿ±ŸÖÿ© 1447ŸáŸÄ Excel</a>
                            <a href="/ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸàÿ≥ÿπ ŸàÿßŸÑÿßÿÆŸäÿ±.docx" download>ÿ™ÿ≠ŸÑŸäŸÑ ÿ¥ÿßŸÖŸÑ ŸÑŸÑÿßÿ≥ÿπÿßÿ± WORD</a>
                        </div>
                    </div>
                </div>
                <!-- Mobile toggle button -->
                <button id="navToggle" aria-expanded="false" aria-controls="navLinks" aria-label="ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ™ŸÜŸÇŸÑ" class="ml-4" role="button">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>
        </div>
    </nav>

    <div id="top" class="container mx-auto p-4 md:p-8">

                <header class="text-center my-10 bg-white p-8 rounded-xl shadow-lg relative overflow-hidden" style="border-top: 5px solid var(--brand-gold);">
                        <div class="absolute inset-0 pointer-events-none opacity-10 bg-gradient-to-bl from-[var(--brand-gold-light)] via-transparent to-[var(--brand-accent)]"></div>
                        <h1 class="text-4xl md:text-6xl font-extrabold mb-3 relative" style="color: var(--brand-dark);">ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿßÿ≥ÿ™ÿ±ÿßÿ™Ÿäÿ¨Ÿä ŸÑÿ£ÿ≥ÿπÿßÿ± ŸÅŸÜÿßÿØŸÇ ÿßŸÑÿπŸÖÿ±ÿ© 1447ŸáŸÄ</h1>
                        <p class="text-xl relative" style="color: var(--brand-muted-text);">ŸÑŸàÿ≠ÿ© ÿ®ŸäÿßŸÜÿßÿ™ ÿ™ŸÅÿßÿπŸÑŸäÿ© ŸÑÿßÿ™ÿÆÿßÿ∞ ŸÇÿ±ÿßÿ±ÿßÿ™ ÿ™ÿ≥ÿπŸäÿ± ŸÖÿØÿ±Ÿàÿ≥ÿ© ŸÅŸä ŸÖŸÉÿ© ŸàÿßŸÑŸÖÿØŸäŸÜÿ©</p>
                        <p id="hijri-date" class="mt-4 text-sm text-gray-600"></p>
                </header>

                <!-- Top Utility Panel: Data Hub & AI Assistant (Refactored Professional Layout) -->
                <section id="utility-panel" class="mb-14 space-y-10">
                    <div class="grid gap-8 md:gap-10 lg:grid-cols-2">
                        <!-- Data Hub Redesigned -->
                        <section id="data-hub" class="section-card !p-6 md:!p-7 lg:!p-8 relative overflow-hidden" aria-labelledby="data-hub-title">
                            <div class="absolute -top-8 -left-8 w-40 h-40 bg-[var(--brand-gold-light)]/10 rounded-full blur-2xl"></div>
                            <header class="mb-6">
                                <h2 id="data-hub-title" class="text-2xl font-extrabold tracking-tight mb-1">üìä ÿ®Ÿàÿßÿ®ÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ (Data Hub)</h2>
                                <p class="text-sm md:text-[15px] leading-relaxed text-[var(--brand-muted-text)]">ÿ•ÿØÿÆÿßŸÑ ÿ™ŸÅÿµŸäŸÑŸä ŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÅŸÜÿØŸÇ: ŸÅÿ™ÿ±ÿßÿ™ ÿßŸÑÿ™ŸàŸÅÿ±ÿå ÿ£ÿ≥ÿπÿßÿ± ÿßŸÑÿ∫ÿ±ŸÅ (ÿ´ŸÜÿßÿ¶Ÿäÿ© / ÿ´ŸÑÿßÿ´Ÿäÿ© / ÿ±ÿ®ÿßÿπŸäÿ©)ÿå ŸàÿµŸÅ ÿÆÿ∑ÿ∑ ÿßŸÑŸàÿ¨ÿ®ÿßÿ™ÿå Ÿàÿ£ÿ≥ÿπÿßÿ± ŸÉŸÑ Ÿàÿ¨ÿ®ÿ©. ÿ®ÿπÿØ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ÿßÿ∂ÿ∫ÿ∑ <strong>ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿÆÿ∑ÿ∑ÿßÿ™</strong> ŸÑÿ™ÿ¨ÿ±ÿ®ÿ© ÿßŸÑŸÖŸÇÿßÿ±ŸÜÿßÿ™ ÿßŸÑŸÅŸàÿ±Ÿäÿ©. Ÿáÿ∞Ÿá ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ™ÿ¨ÿ±Ÿäÿ®Ÿäÿ© ŸÖÿ≠ŸÑŸäÿ© ŸÑÿß ÿ™ÿ§ÿ´ÿ± ÿπŸÑŸâ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿßÿ™ ÿßŸÑÿ£ÿµŸÑŸäÿ©.</p>
                            </header>
                            <form class="space-y-5" onsubmit="return false;" aria-label="ŸÜŸÖŸàÿ∞ÿ¨ ÿ•ÿ∂ÿßŸÅÿ© ÿ®ŸäÿßŸÜÿßÿ™ ŸÅŸÜÿØŸÇ">
                                <!-- Basic Info & Availability -->
                                <fieldset class="space-y-4" aria-labelledby="basicInfoLegend">
                                    <legend id="basicInfoLegend" class="text-xs font-bold text-gray-500 tracking-wider">ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© & ÿßŸÑŸÖÿØÿ©</legend>
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-3 items-end">
                                        <input id="newHotelName" type="text" placeholder="ÿßÿ≥ŸÖ ÿßŸÑŸÅŸÜÿØŸÇ" class="md:col-span-1 p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition" />
                                        <select id="newHotelCity" class="p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition">
                                            <option value="Makkah">ŸÖŸÉÿ©</option>
                                            <option value="Madinah">ÿßŸÑŸÖÿØŸäŸÜÿ©</option>
                                        </select>
                                        <input id="newHotelDateFrom" type="date" placeholder="ŸÖŸÜ (ŸÖŸäŸÑÿßÿØŸä)" class="p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition" />
                                        <input id="newHotelDateTo" type="date" placeholder="ÿ•ŸÑŸâ (ŸÖŸäŸÑÿßÿØŸä)" class="p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition" />
                                        <!-- ÿ≠ŸÇŸàŸÑ Ÿáÿ¨ÿ±Ÿä (ŸÖÿÆŸÅŸäÿ© ÿßŸÅÿ™ÿ±ÿßÿ∂ŸäÿßŸã) -->
                                        <div id="hijriInputs" class="md:col-span-4 grid grid-cols-1 md:grid-cols-4 gap-3 mt-2 hidden">
                                            <input id="newHotelDateFromHijri" type="text" placeholder="ŸÖŸÜ (Ÿáÿ¨ÿ±Ÿä) ŸÖÿ´ÿßŸÑ: 10/02/1447" class="p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition" />
                                            <input id="newHotelDateToHijri" type="text" placeholder="ÿ•ŸÑŸâ (Ÿáÿ¨ÿ±Ÿä) ŸÖÿ´ÿßŸÑ: 15/02/1447" class="p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition" />
                                            <input id="hijriYear" type="number" placeholder="ÿßŸÑÿ≥ŸÜÿ© ÿßŸÑŸáÿ¨ÿ±Ÿäÿ©" class="p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition" />
                                            <div class="text-xs text-gray-500 flex items-center">ÿ£ÿØÿÆŸÑ (ŸäŸàŸÖ/ÿ¥Ÿáÿ±/ÿ≥ŸÜÿ©)</div>
                                        </div>
                                        <!-- ÿ¥ÿ±Ÿäÿ∑ ÿßÿÆÿ™Ÿäÿßÿ± ŸÜŸàÿπ ÿßŸÑÿ™ŸÇŸàŸäŸÖ -->
                                        <div class="col-span-full flex items-center gap-2 pt-1">
                                            <span class="text-[11px] text-gray-500 font-semibold">ÿßŸÑÿ™ŸÇŸàŸäŸÖ:</span>
                                            <button type="button" class="cal-mode-btn active" data-calmode="greg" aria-pressed="true">ŸÖŸäŸÑÿßÿØŸä</button>
                                            <button type="button" class="cal-mode-btn" data-calmode="hijri" aria-pressed="false">Ÿáÿ¨ÿ±Ÿä</button>
                                            <span id="hijriLibWarn" class="hijri-warning">ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÉÿ™ÿ®ÿ© moment-hijriÿå ŸÑŸÜ ŸäÿπŸÖŸÑ ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ.</span>
                                        </div>
                                    </div>
                                    <!-- Actions Row -->
                                    <div class="flex flex-wrap gap-3 pt-2">
                                        <button id="addDataBtn" type="button" class="px-6 py-2.5 rounded-lg text-sm font-semibold bg-[var(--brand-dark)] text-white hover:bg-[var(--brand-accent)] focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-[var(--brand-gold-light)] transition">
                                            + ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                                        </button>
                                        <button id="refreshChartsBtn" type="button" class="px-6 py-2.5 rounded-lg text-sm font-semibold bg-[var(--brand-gold)] text-white hover:bg-[var(--brand-gold-light)] focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-[var(--brand-gold-light)] transition">
                                            üîÑ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿÆÿ∑ÿ∑ÿßÿ™
                                        </button>
                                    </div>
                                </fieldset>
                                <!-- Room Prices -->
                                <fieldset class="space-y-4" aria-labelledby="roomPricesLegend">
                                    <legend id="roomPricesLegend" class="text-xs font-bold text-gray-500 tracking-wider">ÿ£ÿ≥ÿπÿßÿ± ÿßŸÑÿ∫ÿ±ŸÅ (ÿ±ŸäÿßŸÑ)</legend>
                                    <div class="grid grid-cols-3 gap-3">
                                        <input id="newPriceDbl" type="number" min="0" placeholder="ÿ´ŸÜÿßÿ¶Ÿäÿ© (BL)" class="p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition" />
                                        <input id="newPriceTpl" type="number" min="0" placeholder="ÿ´ŸÑÿßÿ´Ÿäÿ© (PL)" class="p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition" />
                                        <input id="newPriceQuad" type="number" min="0" placeholder="ÿ±ÿ®ÿßÿπŸäÿ© (D)" class="p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition" />
                                    </div>
                                </fieldset>
                                <!-- Meal Plan Descriptions -->
                                <fieldset class="space-y-4" aria-labelledby="mealPlanLegend">
                                    <legend id="mealPlanLegend" class="text-xs font-bold text-gray-500 tracking-wider">ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸàÿ¨ÿ®ÿßÿ™ ŸàÿÆÿ∑ÿ∑ ÿßŸÑÿ•ÿ∑ÿπÿßŸÖ</legend>
                                    <input id="newMealPlanDesc" type="text" placeholder="(ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)" class="w-full p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition" />
                                </fieldset>
                            </form>
                            <div class="mt-8 grid gap-6">
                                <div class="relative">
                                    <div class="flex items-center justify-between mb-2 flex-wrap gap-2">
                                        <h3 class="text-sm font-bold text-[var(--brand-dark)] mb-1">ŸÖÿÆÿ∑ÿ∑ ŸÖŸÇÿßÿ±ŸÜÿ© ŸÅŸàÿ±Ÿä (ÿ≠ÿ≥ÿ® ŸÜŸàÿπ ÿßŸÑÿ∫ÿ±ŸÅÿ©)</h3>
                                        <div class="inline-flex rounded-lg overflow-hidden border border-gray-300 bg-white shadow-sm" role="group" aria-label="ÿ™ÿ≠ÿØŸäÿØ ŸÜŸàÿπ ÿßŸÑÿ∫ÿ±ŸÅÿ© ŸÑŸÑŸÖÿÆÿ∑ÿ∑">
                                            <button type="button" data-roomtype="quad" class="px-3 py-1.5 text-xs md:text-sm font-semibold hover:bg-gray-100 focus:outline-none focus:ring-1 focus:ring-[var(--brand-gold-light)]">QUAD</button>
                                            <button type="button" data-roomtype="tpl" class="px-3 py-1.5 text-xs md:text-sm font-semibold hover:bg-gray-100 focus:outline-none focus:ring-1 focus:ring-[var(--brand-gold-light)]">TRPL</button>
                                            <button type="button" data-roomtype="dbl" class="px-3 py-1.5 text-xs md:text-sm font-semibold bg-[var(--brand-gold)] text-white focus:outline-none focus:ring-1 focus:ring-[var(--brand-gold-light)]">DBL</button>
                                        </div>
                                    </div>
                                    <div class="rounded-xl border border-gray-200 bg-white/70 backdrop-blur-sm overflow-auto max-h-60 ring-1 ring-gray-900/5">
                                        <table class="min-w-full text-[11px] md:text-xs lg:text-[13px]">
                                            <thead class="bg-gray-50 text-gray-600 sticky top-0">
                                                <tr class="divide-x divide-gray-200 whitespace-nowrap">
                                                    <th class="p-2 font-semibold">ÿßŸÑŸÅŸÜÿØŸÇ</th>
                                                    <th class="p-2 font-semibold">ÿßŸÑŸÖÿØŸäŸÜÿ©</th>
                                                    <th class="p-2 font-semibold">ŸÖŸÜ</th>
                                                    <th class="p-2 font-semibold">ÿ•ŸÑŸâ</th>
                                                    <th class="p-2 font-semibold">DBL</th>
                                                    <th class="p-2 font-semibold">TRPL</th>
                                                    <th class="p-2 font-semibold">QUAD</th>
                                                    <th class="p-2 font-semibold">ÿßŸÑŸàÿ¨ÿ®ÿßÿ™</th>
                                                </tr>
                                            </thead>
                                            <tbody id="newDataTbody" class="divide-y divide-gray-100"></tbody>
                                        </table>
                                    </div>
                                    <p class="mt-2 text-[11px] md:text-xs text-gray-500">* ÿ≠ŸÅÿ∏ ŸÖÿ§ŸÇÿ™ ÿØÿßÿÆŸÑ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© (ŸÑŸÜ ŸäŸèÿ≠ŸÅÿ∏ ÿ®ÿπÿØ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ).</p>
                                    <p class="mt-2 text-[10px] text-gray-500">ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ŸÑÿ™ÿ∫ŸäŸäÿ± ŸÜŸàÿπ ÿßŸÑÿ∫ÿ±ŸÅÿ© ÿßŸÑŸÖÿπÿ±Ÿàÿ∂. Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ´ŸÜÿßÿ¶Ÿä ÿßŸÑŸÇÿØŸäŸÖ ŸÉŸÄ DBL ÿπŸÜÿØ ÿπÿØŸÖ ÿ™ŸàŸÅÿ± ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑÿ¨ÿØŸäÿØÿ©.</p>
                                </div>
                            </div>
                        </section>

                        <!-- AI Assistant Redesigned -->
                        <section id="ai-assistant" class="section-card !p-6 md:!p-7 lg:!p-8 relative overflow-hidden" aria-labelledby="ai-assistant-title">
                            <div class="absolute -bottom-10 -right-10 w-48 h-48 bg-[var(--brand-gold)]/10 rounded-full blur-2xl"></div>
                            <header class="mb-6">
                                <h2 id="ai-assistant-title" class="text-2xl font-extrabold tracking-tight mb-1">ü§ñ ŸÖÿ≥ÿßÿπÿØ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä (ÿ™ÿ¨ÿ±Ÿäÿ®Ÿä)</h2>
                                <p class="text-sm md:text-[15px] leading-relaxed text-[var(--brand-muted-text)]">ÿßÿ∑ŸÑÿ® ÿ™ÿ≠ŸÑŸäŸÑÿßŸã ÿ≥ÿ±ŸäÿπŸãÿß ŸÑŸÑÿ≥ŸàŸÇ ÿ£Ÿà ÿ™ŸàÿµŸäÿ© ŸÅŸÜÿØŸÇŸäÿ© ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©. ŸÑÿ™ŸÅÿπŸäŸÑ Ÿàÿßÿ¨Ÿáÿ© ÿ≠ŸÇŸäŸÇŸäÿ© ÿ∂ÿπ <code class="bg-gray-100 px-1 rounded text-[11px]">apiUrl</code> ŸÅŸä ÿßŸÑÿ¥ŸäŸÅÿ±ÿ©.</p>
                            </header>
                            <div class="space-y-8">
                                <div class="bg-white/70 backdrop-blur-sm border border-gray-200 rounded-xl p-4 relative">
                                    <h3 class="font-bold text-[var(--brand-dark)] mb-3 text-sm md:text-base">ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ≥ŸàŸÇ ÿßŸÑŸÖÿÆÿ™ÿµÿ±</h3>
                                    <button id="getMarketAnalysisBtn" type="button" class="w-full md:w-auto px-5 py-2.5 rounded-lg text-sm font-semibold bg-[var(--brand-dark)] text-white hover:bg-[var(--brand-accent)] focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-[var(--brand-gold-light)] transition">‚ö° ÿßÿ∑ŸÑÿ® ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ</button>
                                    <div class="flex items-center gap-3 mt-3">
                                        <div id="marketAnalysisLoader" class="hidden animate-spin h-5 w-5 rounded-full border-2 border-[var(--brand-gold-light)] border-t-transparent"></div>
                                        <div id="marketAnalysisResult" class="flex-1 min-h-[70px] text-xs md:text-sm leading-relaxed text-gray-700"></div>
                                    </div>
                                </div>
                                <div class="bg-white/70 backdrop-blur-sm border border-gray-200 rounded-xl p-4 relative">
                                    <h3 class="font-bold text-[var(--brand-dark)] mb-3 text-sm md:text-base">ÿ™ŸàÿµŸäÿ© ŸÅŸÜÿØŸÇŸäÿ© ŸÖÿÆÿµÿµÿ©</h3>
                                    <div class="space-y-3">
                                        <textarea id="hotelQueryInput" rows="3" class="w-full resize-y p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none text-sm" placeholder="ŸÖÿ´ÿßŸÑ: ÿ£ÿ±ŸäÿØ ŸÅŸÜÿØŸÇ 5 ŸÜÿ¨ŸàŸÖ ŸÅŸä ŸÖŸÉÿ© ŸÇÿ±Ÿäÿ® ÿ®ÿ≥ÿπÿ± ÿ£ŸÇŸÑ ŸÖŸÜ 800 ÿ±ŸäÿßŸÑ ŸàŸäÿ¥ŸÖŸÑ ÿ•ŸÅÿ∑ÿßÿ±"></textarea>
                                        <button id="getHotelRecommendationBtn" type="button" class="w-full md:w-auto px-5 py-2.5 rounded-lg text-sm font-semibold bg-[var(--brand-gold)] text-white hover:bg-[var(--brand-gold-light)] focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-[var(--brand-gold-light)] transition">‚ú® ÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ÿ™ŸàÿµŸäÿ©</button>
                                        <div class="flex items-center gap-3 mt-2">
                                            <div id="hotelRecommendationLoader" class="hidden animate-spin h-5 w-5 rounded-full border-2 border-[var(--brand-gold)] border-t-transparent"></div>
                                            <div id="hotelRecommendationResult" class="flex-1 min-h-[70px] text-xs md:text-sm leading-relaxed text-gray-700"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                    <hr class="border-dashed border-[var(--brand-gold-light)]/40 mt-4" aria-hidden="true" />
                </section>

                <main class="space-y-16" id="main-sections">

            <!-- Makkah Section -->
            <section id="makkah" class="section-card" role="region" aria-labelledby="makkah-title">
                <h2 id="makkah-title" class="text-3xl font-bold text-center mb-8">ÿ™ÿ≠ŸÑŸäŸÑ ÿ≥ŸàŸÇ ŸÅŸÜÿßÿØŸÇ ŸÖŸÉÿ© ÿßŸÑŸÖŸÉÿ±ŸÖÿ©</h2>
                <p class="text-center mb-12 max-w-4xl mx-auto">
                    Ÿäÿ™ŸÖŸäÿ≤ ÿ≥ŸàŸÇ ŸÖŸÉÿ© ÿ®ÿ™ŸÜŸàÿπŸá ÿßŸÑŸÉÿ®Ÿäÿ±ÿå ÿ®ÿØÿ°Ÿãÿß ŸÖŸÜ ÿßŸÑŸÅŸÜÿßÿØŸÇ ÿßŸÑŸÅÿßÿÆÿ±ÿ© ÿßŸÑŸÖÿ∑ŸÑÿ© ÿπŸÑŸâ ÿßŸÑÿ≠ÿ±ŸÖ ŸàÿµŸàŸÑŸãÿß ÿ•ŸÑŸâ ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿßŸÇÿ™ÿµÿßÿØŸäÿ© ŸÅŸä ÿßŸÑŸÖŸÜÿßÿ∑ŸÇ ÿßŸÑŸÖÿ¨ÿßŸàÿ±ÿ©. Ÿáÿ∞ÿß ÿßŸÑŸÇÿ≥ŸÖ Ÿäÿ∫Ÿàÿµ ŸÅŸä ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ŸÑŸÖÿÆÿ™ŸÑŸÅ ÿßŸÑŸÅÿ¶ÿßÿ™ Ÿàÿ™ÿ∑Ÿàÿ±Ÿáÿß ÿπÿ®ÿ± ÿ£ÿ¥Ÿáÿ± ÿßŸÑŸÖŸàÿ≥ŸÖ.
                </p>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
                    
                    <div class="w-full">
                        <h3 class="text-xl font-bold text-center mb-4">ŸÖŸÇÿßÿ±ŸÜÿ© ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑŸÅŸÜÿßÿØŸÇ ÿßŸÑŸÅÿßÿÆÿ±ÿ©</h3>
                        <p class="text-center text-sm text-gray-500 mb-4">ŸÖÿ™Ÿàÿ≥ÿ∑ ÿ≥ÿπÿ± ÿßŸÑÿ∫ÿ±ŸÅÿ© ÿßŸÑÿ´ŸÜÿßÿ¶Ÿäÿ© ŸÖÿπ ÿ•ŸÅÿ∑ÿßÿ± (ÿ£ÿ∫ÿ≥ÿ∑ÿ≥ - ÿ≥ÿ®ÿ™ŸÖÿ®ÿ± 2025)</p>
                        <div class="chart-container">
                            <canvas id="makkahPremiumComparisonChart"></canvas>
                        </div>
                        <p class="text-center mt-4 text-sm text-gray-600">
                           Ÿäÿ≠ÿ™ŸÑ "ŸÅŸäÿ±ŸÖŸàŸÜÿ™ ÿ≥ÿßÿπÿ© ŸÖŸÉÿ©" ŸÇŸÖÿ© ÿßŸÑŸáÿ±ŸÖ ÿßŸÑÿ≥ÿπÿ±Ÿäÿå ÿ®ŸäŸÜŸÖÿß ÿ™ÿ∏Ÿáÿ± ÿßŸÑŸÖŸÜÿßŸÅÿ≥ÿ© ÿßŸÑÿ¥ÿØŸäÿØÿ© ŸÅŸä ÿßŸÑŸÅÿ¶ÿ© ÿßŸÑÿ™ÿßŸÑŸäÿ© ÿ®ŸäŸÜ "ŸÖŸàŸÅŸÜÿ®ŸäŸÉ" Ÿà "ÿ®ŸàŸÑŸÖÿßŸÜ". ŸäŸàŸÅÿ± "ÿ¥Ÿäÿ±ÿßÿ™ŸàŸÜ ÿ¨ÿ®ŸÑ ÿßŸÑŸÉÿπÿ®ÿ©" Ÿà "ÿßŸÑÿ¥ŸáÿØÿßÿ°" ŸÜŸÇÿßÿ∑ ÿ≥ÿπÿ±Ÿäÿ© ÿ™ŸÜÿßŸÅÿ≥Ÿäÿ© ŸÑŸÑÿ∫ÿßŸäÿ©.
                        </p>
                    </div>

                    <div class="w-full">
                        <h3 class="text-xl font-bold text-center mb-4">ŸÖŸÇÿßÿ±ŸÜÿ© ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑŸÅŸÜÿßÿØŸÇ ÿßŸÑÿßŸÇÿ™ÿµÿßÿØŸäÿ©</h3>
                         <p class="text-center text-sm text-gray-500 mb-4">ŸÖÿ™Ÿàÿ≥ÿ∑ ÿ≥ÿπÿ± ÿßŸÑÿ∫ÿ±ŸÅÿ© ÿ®ÿØŸàŸÜ Ÿàÿ¨ÿ®ÿßÿ™ (ÿ£ÿ∫ÿ≥ÿ∑ÿ≥ - ÿ≥ÿ®ÿ™ŸÖÿ®ÿ± 2025)</p>
                        <div class="chart-container">
                            <canvas id="makkahBudgetComparisonChart"></canvas>
                        </div>
                         <p class="text-center mt-4 text-sm text-gray-600">
                           ÿ™ŸáŸäŸÖŸÜ ÿßŸÑŸÅŸÜÿßÿØŸÇ ŸÅŸä ŸÖŸÜÿßÿ∑ŸÇ ŸÖÿ≠ÿ®ÿ≥ ÿßŸÑÿ¨ŸÜ Ÿàÿ±Ÿäÿπ ÿ®ÿÆÿ¥ ÿπŸÑŸâ ÿßŸÑÿ¥ÿ±Ÿäÿ≠ÿ© ÿßŸÑÿßŸÇÿ™ÿµÿßÿØŸäÿ©ÿå ŸÖÿπ ÿ£ÿ≥ÿπÿßÿ± ÿ™ŸÜÿßŸÅÿ≥Ÿäÿ© ŸÑŸÑÿ∫ÿßŸäÿ© ÿ™ŸÇÿØŸÖŸáÿß ŸÅŸÜÿßÿØŸÇ ŸÖÿ´ŸÑ "ÿ£ÿ®ÿ±ÿßÿ¨ ÿßŸÑŸÉÿ≥Ÿàÿ©" Ÿà "ŸÜŸàÿßÿ≤Ÿä ÿ£ÿ¨ŸäÿßÿØ".
                        </p>
                    </div>

                     <div class="w-full">
                        <h3 class="text-xl font-bold text-center mb-4">ÿ™ÿ∑Ÿàÿ± ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ÿÆŸÑÿßŸÑ ÿßŸÑŸÖŸàÿ≥ŸÖ (ŸÅŸÜÿØŸÇ ÿßŸÑÿ¥ŸáÿØÿßÿ°)</h3>
                         <p class="text-center text-sm text-gray-500 mb-4">ÿ™ÿ∫Ÿäÿ± ŸÖÿ™Ÿàÿ≥ÿ∑ ÿ≥ÿπÿ± ÿßŸÑÿ∫ÿ±ŸÅÿ© ÿßŸÑÿ´ŸÜÿßÿ¶Ÿäÿ© ŸÖŸÜ ÿ®ÿØÿßŸäÿ© ÿßŸÑŸÖŸàÿ≥ŸÖ ÿ•ŸÑŸâ ŸÅÿ™ÿ±ÿ© ÿßŸÑÿ∞ÿ±Ÿàÿ©</p>
                        <div class="chart-container">
                            <canvas id="makkahPriceEvolutionChart"></canvas>
                        </div>
                         <p class="text-center mt-4 text-sm text-gray-600">
                           ŸäŸÑÿßÿ≠ÿ∏ ÿßÿ±ÿ™ŸÅÿßÿπ ÿ™ÿØÿ±Ÿäÿ¨Ÿä Ÿàÿ≠ÿßÿØ ŸÅŸä ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ŸÖÿπ ÿßŸÑÿßŸÇÿ™ÿ±ÿßÿ® ŸÖŸÜ ŸÜŸáÿßŸäÿ© ÿßŸÑÿπÿßŸÖÿå ÿ≠Ÿäÿ´ ÿ™ÿµŸÑ ÿßŸÑÿ≤ŸäÿßÿØÿ© ÿ•ŸÑŸâ ÿ£ŸÉÿ´ÿ± ŸÖŸÜ ÿßŸÑÿ∂ÿπŸÅÿå ŸÖŸÖÿß Ÿäÿ§ŸÉÿØ ÿ£ŸáŸÖŸäÿ© ÿßŸÑÿ≠ÿ¨ÿ≤ ÿßŸÑŸÖÿ®ŸÉÿ±.
                        </p>
                    </div>
                    
                    <div class="w-full">
                        <h3 class="text-xl font-bold text-center mb-4">ÿ™Ÿàÿ≤Ÿäÿπ ÿ®ÿßŸÇÿßÿ™ ÿßŸÑŸàÿ¨ÿ®ÿßÿ™ ŸÅŸä ÿßŸÑÿ≥ŸàŸÇ</h3>
                         <p class="text-center text-sm text-gray-500 mb-4">ŸÜÿ≥ÿ®ÿ© ÿßŸÜÿ™ÿ¥ÿßÿ± ÿ£ŸÜŸàÿßÿπ ÿ®ÿßŸÇÿßÿ™ ÿßŸÑŸàÿ¨ÿ®ÿßÿ™ ÿ®ŸäŸÜ ÿßŸÑŸÅŸÜÿßÿØŸÇ ÿßŸÑŸÖÿπÿ±Ÿàÿ∂ÿ©</p>
                        <div class="chart-container">
                            <canvas id="makkahMealPlanChart"></canvas>
                        </div>
                         <p class="text-center mt-4 text-sm text-gray-600">
                           ÿ™ÿ™ÿ±ŸÉÿ≤ ÿßŸÑÿπÿ±Ÿàÿ∂ ÿ®ÿ¥ŸÉŸÑ ŸÉÿ®Ÿäÿ± ÿπŸÑŸâ ÿ®ÿßŸÇÿßÿ™ ÿßŸÑÿ•ŸÅÿ∑ÿßÿ± (BB) ŸàÿßŸÑÿ∫ÿ±ŸÅ ŸÅŸÇÿ∑ (RO)ÿå ŸÖŸÖÿß Ÿäÿ™Ÿäÿ≠ ŸÖÿ±ŸàŸÜÿ© ŸÑŸÑÿ¥ÿ±ŸÉÿßÿ™ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿÆÿØŸÖÿßÿ™ ÿßŸÑÿ•ÿπÿßÿ¥ÿ© ÿ®ÿ¥ŸÉŸÑ ŸÖÿ≥ÿ™ŸÇŸÑ.
                        </p>
                    </div>

                </div>
            </section>

            <!-- Madinah Section -->
            <section id="madinah" class="section-card" role="region" aria-labelledby="madinah-title">
                <h2 id="madinah-title" class="text-3xl font-bold text-center mb-8">ÿ™ÿ≠ŸÑŸäŸÑ ÿ≥ŸàŸÇ ŸÅŸÜÿßÿØŸÇ ÿßŸÑŸÖÿØŸäŸÜÿ© ÿßŸÑŸÖŸÜŸàÿ±ÿ©</h2>
                 <p class="text-center mb-12 max-w-4xl mx-auto">
                    ÿ™ÿ™ÿ±ŸÉÿ≤ ÿßŸÑŸÖŸÜÿßŸÅÿ≥ÿ© ŸÅŸä ÿßŸÑŸÖÿØŸäŸÜÿ© ÿßŸÑŸÖŸÜŸàÿ±ÿ© ŸÅŸä ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÖÿ±ŸÉÿ≤Ÿäÿ©. ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ™ÿßŸÑŸä ŸäŸÇÿØŸÖ ŸÖŸÇÿßÿ±ŸÜÿ© ÿ¥ÿßŸÖŸÑÿ© ŸÑŸÑÿ£ÿ≥ÿπÿßÿ± ŸàŸäÿ≠ŸÑŸÑ ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑÿ™Ÿä Ÿäÿ≠ÿµŸÑ ÿπŸÑŸäŸáÿß ÿßŸÑŸÖÿπÿ™ŸÖÿ± ŸÖŸÇÿßÿ®ŸÑ ÿßŸÑÿ≥ÿπÿ± ÿßŸÑŸÖÿØŸÅŸàÿπ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑÿÆÿØŸÖÿßÿ™ ÿßŸÑŸÖÿ∂ŸÖŸÜÿ©.
                </p>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
                    <div class="w-full">
                        <h3 class="text-xl font-bold text-center mb-4">ŸÖŸÇÿßÿ±ŸÜÿ© ŸÖÿ™Ÿàÿ≥ÿ∑ ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑŸÅŸÜÿßÿØŸÇ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</h3>
                        <p class="text-center text-sm text-gray-500 mb-4">ÿ∫ÿ±ŸÅÿ© ÿ´ŸÜÿßÿ¶Ÿäÿ© (ÿ£ÿ∫ÿ≥ÿ∑ÿ≥ - ÿ≥ÿ®ÿ™ŸÖÿ®ÿ± 2025)</p>
                        <div class="chart-container">
                            <canvas id="madinahComparisonChart"></canvas>
                        </div>
                        <p class="text-center mt-4 text-sm text-gray-600">
                           ÿ™ÿ™ŸÅÿßŸàÿ™ ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ÿ®ÿ¥ŸÉŸÑ ŸÉÿ®Ÿäÿ±ÿå ÿ≠Ÿäÿ´ Ÿäÿ™ÿµÿØÿ± "ÿØÿßÿ± ÿßŸÑÿ•ŸäŸÖÿßŸÜ ÿ•ŸÜÿ™ÿ±ŸÉŸàŸÜÿ™ŸäŸÜŸÜÿ™ÿßŸÑ" ÿßŸÑŸÇÿßÿ¶ŸÖÿ©ÿå ÿ®ŸäŸÜŸÖÿß ÿ™ŸÇÿØŸÖ ŸÅŸÜÿßÿØŸÇ ŸÖÿ´ŸÑ "ÿßŸÑÿ£ŸÜÿµÿßÿ± ÿ¨ŸàŸÑÿØŸÜ ÿ™ŸàŸÑŸäÿ®" Ÿà "ŸÉŸàŸÜŸÉŸàÿ±ÿØ ÿØÿßÿ± ÿßŸÑÿÆŸäÿ±" ÿ®ÿØÿßÿ¶ŸÑ ÿßŸÇÿ™ÿµÿßÿØŸäÿ© ŸÖŸÖÿ™ÿßÿ≤ÿ© ŸÅŸä ŸÇŸÑÿ® ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÖÿ±ŸÉÿ≤Ÿäÿ©.
                        </p>
                    </div>
                     <div class="w-full">
                        <h3 class="text-xl font-bold text-center mb-4">ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÇŸäŸÖÿ©: ÿßŸÑÿ≥ÿπÿ± ŸÖŸÇÿßÿ®ŸÑ ÿßŸÑŸàÿ¨ÿ®ÿßÿ™</h3>
                        <p class="text-center text-sm text-gray-500 mb-4">ŸÖŸÇÿßÿ±ŸÜÿ© ÿ®ŸäŸÜ ÿ™ŸÉŸÑŸÅÿ© ÿßŸÑŸÅŸÜÿØŸÇ ŸàŸÜŸàÿπ ÿ®ÿßŸÇÿ© ÿßŸÑŸàÿ¨ÿ®ÿßÿ™ ÿßŸÑŸÖŸÇÿØŸÖÿ©</p>
                        <div class="chart-container">
                            <canvas id="madinahValueChart"></canvas>
                        </div>
                        <p class="text-center mt-4 text-sm text-gray-600">
                           ŸäŸèÿ∏Ÿáÿ± ÿßŸÑÿ±ÿ≥ŸÖ ÿßŸÑÿ®ŸäÿßŸÜŸä ÿ£ŸÜ ÿßŸÑŸÅŸÜÿßÿØŸÇ ÿßŸÑÿ™Ÿä ÿ™ŸÇÿØŸÖ Ÿàÿ¨ÿ®ÿßÿ™ ŸÉÿßŸÖŸÑÿ© (FB) ŸÖÿ´ŸÑ "ÿ≥ÿ¨Ÿâ ÿßŸÑŸÖÿØŸäŸÜÿ©" Ÿà "ÿ•ÿπŸÖÿßÿ± ÿ±ŸàŸäÿßŸÑ" ÿ™ÿ™ÿ±ŸÉÿ≤ ŸÅŸä ŸÜÿ∑ÿßŸÇ ÿ≥ÿπÿ±Ÿä ŸÖÿ™Ÿàÿ≥ÿ∑ÿå ŸÖŸÖÿß Ÿäÿ¨ÿπŸÑŸáÿß ÿÆŸäÿßÿ±ÿßÿ™ ÿ∞ÿßÿ™ ŸÇŸäŸÖÿ© ÿπÿßŸÑŸäÿ©. ÿ®ŸäŸÜŸÖÿß ÿßŸÑŸÅŸÜÿßÿØŸÇ ÿßŸÑÿ£ŸÇŸÑ ÿ≥ÿπÿ±ÿßŸã ŸÑÿß ÿ™ÿ¥ŸÖŸÑ Ÿàÿ¨ÿ®ÿßÿ™.
                        </p>
                    </div>
                </div>
            </section>
            
            <!-- Supplier Analysis Section -->
            <section id="suppliers" class="section-card" role="region" aria-labelledby="suppliers-title">
                <h2 id="suppliers-title" class="text-3xl font-bold text-center mb-8">ÿ™ÿ≠ŸÑŸäŸÑ ÿ£ÿ≥ÿπÿßÿ± ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜ (ŸÅŸÜÿØŸÇ ÿßŸÑÿ¥ŸáÿØÿßÿ°)</h2>
                <p class="text-center mb-12 max-w-4xl mx-auto">
                    ÿ™ÿÆÿ™ŸÑŸÅ ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ŸÑŸÜŸÅÿ≥ ÿßŸÑŸÅŸÜÿØŸÇ ÿ®ŸäŸÜ ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜ ÿßŸÑŸÖÿÆÿ™ŸÑŸÅŸäŸÜ Ÿàÿ™ÿ™ÿ∫Ÿäÿ± ÿßŸÑŸÅÿ±ŸàŸÇÿßÿ™ ŸÖÿπ ÿ™ÿ∫Ÿäÿ± ÿßŸÑŸÖŸàÿ≥ŸÖ. Ÿáÿ∞ÿß ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ Ÿäÿ≥ŸÑÿ∑ ÿßŸÑÿ∂Ÿàÿ° ÿπŸÑŸâ Ÿáÿ∞Ÿá ÿßŸÑŸÅÿ±ŸàŸÇÿßÿ™ ŸÑŸÖÿ≥ÿßÿπÿØÿ™ŸÉ ŸÅŸä ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖÿµÿØÿ± ÿßŸÑÿ£ŸÅÿ∂ŸÑ ÿ™ŸÉŸÑŸÅÿ©.
                </p>
                <div class="w-full">
                    <div class="chart-container">
                        <canvas id="supplierComparisonChart"></canvas>
                    </div>
                    <p class="text-center mt-4 text-sm text-gray-600">
                        Ÿäÿ∏Ÿáÿ± ÿßŸÑÿ±ÿ≥ŸÖ ÿ™ÿ®ÿßŸäŸÜŸãÿß Ÿàÿßÿ∂ÿ≠Ÿãÿß ŸÅŸä ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ÿßŸÑŸÖŸÇÿØŸÖÿ© ŸÖŸÜ ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜ ŸÑŸÜŸÅÿ≥ ÿßŸÑŸÅÿ™ÿ±ÿ©ÿå Ÿàÿ™ÿ™ÿ∫Ÿäÿ± Ÿáÿ∞Ÿá ÿßŸÑŸÅÿ±ŸàŸÇÿßÿ™ ŸÅŸä ŸÅÿ™ÿ±ÿ© ÿßŸÑÿ∞ÿ±Ÿàÿ©ÿå ŸÖŸÖÿß Ÿäÿ§ŸÉÿØ ÿπŸÑŸâ ÿ£ŸáŸÖŸäÿ© ŸÖŸÇÿßÿ±ŸÜÿ© ÿßŸÑÿπÿ±Ÿàÿ∂ ŸÇÿ®ŸÑ ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ≠ÿ¨Ÿàÿ≤ÿßÿ™ ŸÑÿ∂ŸÖÿßŸÜ ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ£ŸÅÿ∂ŸÑ ÿ≥ÿπÿ± ÿ™ŸÉŸÑŸÅÿ©.
                    </p>
                </div>
            </section>

             <!-- Seasonal Peaks Section -->
            <section id="peaks" class="section-card" role="region" aria-labelledby="peaks-title">
                <h2 id="peaks-title" class="text-3xl font-bold text-center mb-8">ÿ∞ÿ±Ÿàÿ© ÿßŸÑŸÖŸàÿ≥ŸÖ: ÿ™ÿ≠ŸÑŸäŸÑ ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ£ÿ≥ÿπÿßÿ±</h2>
                <p class="text-center mb-12 max-w-4xl mx-auto">
                    ÿ™ÿ¥ŸáÿØ ÿßŸÑŸÅÿ™ÿ±ÿ© ŸÖŸÜ ÿ£ŸàÿßÿÆÿ± ÿØŸäÿ≥ŸÖÿ®ÿ± ÿ•ŸÑŸâ ÿ£Ÿàÿßÿ¶ŸÑ ŸäŸÜÿßŸäÿ± ÿßÿ±ÿ™ŸÅÿßÿπŸãÿß ÿ≠ÿßÿØŸãÿß ŸÅŸä ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ÿ®ÿ≥ÿ®ÿ® ÿßŸÑÿ•ÿ¨ÿßÿ≤ÿßÿ™. ŸÖŸÜ ÿßŸÑÿ∂ÿ±Ÿàÿ±Ÿä ÿ£ÿÆÿ∞ Ÿáÿ∞ÿß ÿßŸÑÿßÿ±ÿ™ŸÅÿßÿπ ŸÅŸä ÿßŸÑÿßÿπÿ™ÿ®ÿßÿ± ÿπŸÜÿØ ÿßŸÑÿ™ÿÆÿ∑Ÿäÿ∑ ŸÑŸÑÿ®ÿßŸÇÿßÿ™.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 text-center">
                    <div class="bg-red-50 p-6 rounded-lg">
                        <div class="text-6xl font-extrabold text-red-600">~115%</div>
                        <div class="text-xl text-gray-700 mt-2">ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿ≤ŸäÿßÿØÿ© ŸÅŸä ÿ£ÿ≥ÿπÿßÿ±<br>ŸÅŸÜÿßÿØŸÇ ŸÖŸÉÿ© ÿßŸÑŸÅÿßÿÆÿ±ÿ©</div>
                    </div>
                     <div class="bg-orange-50 p-6 rounded-lg">
                        <div class="text-6xl font-extrabold text-orange-500">~95%</div>
                        <div class="text-xl text-gray-700 mt-2">ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿ≤ŸäÿßÿØÿ© ŸÅŸä ÿ£ÿ≥ÿπÿßÿ±<br>ŸÅŸÜÿßÿØŸÇ ÿßŸÑŸÖÿØŸäŸÜÿ© ÿßŸÑŸÖŸÜŸàÿ±ÿ©</div>
                    </div>
                </div>
            </section>

            <!-- Key Takeaways Section -->
            <section id="takeaways" class="section-card" role="region" aria-labelledby="takeaways-title">
                <h2 id="takeaways-title" class="text-3xl font-bold text-center mb-8">ÿßŸÑÿÆŸÑÿßÿµÿ© ŸàÿßŸÑÿ™ŸàÿµŸäÿßÿ™ ÿßŸÑÿßÿ≥ÿ™ÿ±ÿßÿ™Ÿäÿ¨Ÿäÿ©</h2>
                <div class="max-w-4xl mx-auto space-y-6">
                    <div class="bg-blue-50 p-5 rounded-lg border-r-4 border-blue-500">
                        <h3 class="font-bold text-xl text-blue-800">ŸÖŸÉÿ©: ÿßÿ≥ÿ™ÿ∫ŸÑÿßŸÑ ÿ™ŸÜŸàÿπ ÿßŸÑÿ≥ŸàŸÇ</h3>
                        <p class="text-blue-700 mt-2">ÿßŸÑÿ≥ŸàŸÇ ŸÅŸä ŸÖŸÉÿ© ŸÖÿ™ŸÜŸàÿπ ÿ®ÿ¥ŸÉŸÑ ŸÉÿ®Ÿäÿ±. **ŸÑŸÑÿπŸÖŸÑÿßÿ° ÿßŸÑÿ®ÿßÿ≠ÿ´ŸäŸÜ ÿπŸÜ ÿßŸÑŸÇŸäŸÖÿ©**ÿå Ÿäÿπÿ™ÿ®ÿ± **ŸÅŸÜÿØŸÇ ÿßŸÑÿ¥ŸáÿØÿßÿ°** Ÿà**ÿ¥Ÿäÿ±ÿßÿ™ŸàŸÜ ÿ¨ÿ®ŸÑ ÿßŸÑŸÉÿπÿ®ÿ©** ÿÆŸäÿßÿ±ÿßÿ™ ŸÖŸÖÿ™ÿßÿ≤ÿ© ÿ™ÿ¨ŸÖÿπ ÿ®ŸäŸÜ ÿßŸÑŸÇÿ±ÿ® ŸàÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ¨ŸäÿØ. **ŸÑŸÑŸÖŸäÿ≤ÿßŸÜŸäÿßÿ™ ÿßŸÑŸÖÿ≠ÿØŸàÿØÿ©**ÿå ŸÅŸÜÿßÿØŸÇ ŸÖÿ´ŸÑ **ÿ£ÿ®ÿ±ÿßÿ¨ ÿßŸÑŸÉÿ≥Ÿàÿ©** Ÿà**ŸÜŸàÿßÿ≤Ÿä ÿ£ÿ¨ŸäÿßÿØ** ÿ™ŸÇÿØŸÖ ÿ£ÿ≥ÿπÿßÿ±Ÿãÿß ŸÑÿß ÿ™ŸÇÿ®ŸÑ ÿßŸÑŸÖŸÜÿßŸÅÿ≥ÿ©.</p>
                    </div>
                    <div class="bg-green-50 p-5 rounded-lg border-r-4 border-green-500">
                        <h3 class="font-bold text-xl text-green-800">ÿßŸÑŸÖÿØŸäŸÜÿ©: ÿßŸÑÿ™ÿ±ŸÉŸäÿ≤ ÿπŸÑŸâ ÿßŸÑŸÇŸäŸÖÿ© ÿßŸÑŸÖÿ∂ÿßŸÅÿ©</h3>
                        <p class="text-green-700 mt-2">ŸÅŸä ÿßŸÑŸÖÿØŸäŸÜÿ©ÿå ÿßŸÑŸÇŸäŸÖÿ© ŸÑÿß ÿ™ŸÇÿßÿ≥ ÿ®ÿßŸÑÿ≥ÿπÿ± ŸÅŸÇÿ∑. **ŸÅŸÜÿØŸÇ ÿ≥ÿ¨Ÿâ ÿßŸÑŸÖÿØŸäŸÜÿ©** ŸäŸÇÿØŸÖ ÿ£ŸÅÿ∂ŸÑ ÿ®ÿßŸÇÿ© ŸÖÿ™ŸÉÿßŸÖŸÑÿ© (ÿ≥ÿπÿ± + ÿ•ŸÅÿ∑ÿßÿ±). ÿπŸÜÿØ ÿßŸÑÿ™ÿ≥ŸàŸäŸÇÿå ÿ±ŸÉÿ≤ ÿπŸÑŸâ ÿ£ŸÜ ÿ®ÿßŸÇÿßÿ™ ÿßŸÑŸÅŸÜÿßÿØŸÇ ÿßŸÑÿ™Ÿä ÿ™ÿ¥ŸÖŸÑ Ÿàÿ¨ÿ®ÿßÿ™ ÿ™ŸàŸÅÿ± ÿ±ÿßÿ≠ÿ© Ÿàÿ™ŸàŸÅŸäÿ±Ÿãÿß ÿ£ŸÉÿ®ÿ± ŸÑŸÑŸÖÿπÿ™ŸÖÿ± ÿπŸÑŸâ ÿßŸÑŸÖÿØŸâ ÿßŸÑÿ∑ŸàŸäŸÑ.</p>
                    </div>
                    <div class="bg-purple-50 p-5 rounded-lg border-r-4 border-purple-500">
                        <h3 class="font-bold text-xl text-purple-800">ÿ£ŸáŸÖŸäÿ© ŸÖŸÇÿßÿ±ŸÜÿ© ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜ</h3>
                        <p class="text-purple-700 mt-2">ŸÉŸÖÿß ÿ£ÿ∏Ÿáÿ± ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿå ŸäŸÖŸÉŸÜ ÿ£ŸÜ ÿ™ÿµŸÑ ŸÅÿ±ŸàŸÇÿßÿ™ ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ŸÑŸÜŸÅÿ≥ ÿßŸÑŸÅŸÜÿØŸÇ ÿ®ŸäŸÜ ÿßŸÑŸÖŸàÿ±ÿØŸäŸÜ ÿ•ŸÑŸâ **15%**. ŸÖŸÜ ÿßŸÑÿ∂ÿ±Ÿàÿ±Ÿä ÿ®ŸÜÿßÿ° ÿπŸÑÿßŸÇÿßÿ™ ŸÖÿπ ŸÖŸàÿ±ÿØŸäŸÜ ŸÖÿ™ÿπÿØÿØŸäŸÜ ŸàÿßŸÑŸÖŸÇÿßÿ±ŸÜÿ© ÿßŸÑÿØÿßÿ¶ŸÖÿ© ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ£ŸÅÿ∂ŸÑ ÿ™ŸÉŸÑŸÅÿ© ŸÖŸÖŸÉŸÜÿ©.</p>
                    </div>
                    <div class="bg-yellow-50 p-5 rounded-lg border-r-4 border-yellow-500">
                        <h3 class="font-bold text-xl text-yellow-800">ÿßŸÑÿ™ÿ≥ÿπŸäÿ± ÿßŸÑÿØŸäŸÜÿßŸÖŸäŸÉŸä Ÿàÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ∞ÿ±Ÿàÿ©</h3>
                        <p class="text-yellow-700 mt-2">ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ÿ™ÿ±ÿ™ŸÅÿπ ÿ®ÿ¥ŸÉŸÑ ÿ≠ÿßÿØ ŸÅŸä ŸÜŸáÿßŸäÿ© ÿØŸäÿ≥ŸÖÿ®ÿ±. **ŸÜŸàÿµŸä ÿ®ÿ¥ÿØÿ©** ÿ®ÿ™ÿ∑ÿ®ŸäŸÇ ÿßÿ≥ÿ™ÿ±ÿßÿ™Ÿäÿ¨Ÿäÿ© ÿ™ÿ≥ÿπŸäÿ± ÿØŸäŸÜÿßŸÖŸäŸÉŸäÿ©ÿå ŸÖÿπ ÿ±ŸÅÿπ ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ÿ®ÿ¥ŸÉŸÑ ŸÉÿ®Ÿäÿ± ŸÑŸáÿ∞Ÿá ÿßŸÑŸÅÿ™ÿ±ÿ© Ÿàÿ™ŸÇÿØŸäŸÖ ÿπÿ±Ÿàÿ∂ ÿÆÿßÿµÿ© ŸÑŸÑÿ≠ÿ¨Ÿàÿ≤ÿßÿ™ ÿßŸÑŸÖÿ®ŸÉÿ±ÿ© ŸÑÿ™ÿ£ŸÖŸäŸÜ ÿßŸÑÿ∫ÿ±ŸÅ ŸÇÿ®ŸÑ ŸàÿµŸàŸÑ ÿßŸÑÿ∞ÿ±Ÿàÿ©.</p>
                    </div>
                </div>
            </section>

    </main>

    <footer class="text-center mt-16 pt-8 border-t" style="border-color: var(--brand-gold-light);">
            <p style="color: var(--brand-muted-text);">&copy; 2025 ÿ¥ÿ±ŸÉÿ© ÿßŸÑÿ™ŸàÿßÿµŸÑ ÿßŸÑÿπÿßŸÑŸÖŸä. ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©.</p>
        </footer>

    </div>

    <a href="#top" id="toTopBtn" aria-label="ÿßŸÑÿπŸàÿØÿ© ÿ•ŸÑŸâ ÿßŸÑÿ£ÿπŸÑŸâ" class="bg-gray-800 text-white rounded-full p-3 shadow-lg hover:bg-gray-700">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
        </svg>
    </a>

    <script>
        // --- Professional Enhancements ---
        // 1. Back to Top Button Logic
        const toTopBtn = document.getElementById('toTopBtn');
        window.onscroll = function() {
            if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                toTopBtn.classList.add('show');
            } else {
                toTopBtn.classList.remove('show');
            }
        };

        // 2. Read CSS Variables for Charts
        const computedStyle = getComputedStyle(document.documentElement);
        const brandPalette = {
            gold: computedStyle.getPropertyValue('--brand-gold').trim() || '#b8862f',
            goldLight: computedStyle.getPropertyValue('--brand-gold-light').trim() || '#d4af37',
            dark: computedStyle.getPropertyValue('--brand-dark').trim() || '#3a2d1f',
            accent: computedStyle.getPropertyValue('--brand-accent').trim() || '#8c6c2f',
            mutedText: computedStyle.getPropertyValue('--brand-muted-text').trim() || '#6e6051'
        };
        // --- End of Enhancements ---

        const chartColors = [
            brandPalette.gold,
            brandPalette.goldLight,
            brandPalette.accent,
            '#c89f54', // lighter gold
            '#6b4f2c', // darker brown
            '#e0c89d', // sand
            brandPalette.mutedText
        ];

        // --- Data for Charts and Export ---
        const reportData = {
            makkahPremium: [
                { hotel: 'ŸÅŸÜÿØŸÇ ÿ£ŸÜÿ¨ŸÖ', cost: 482 }, { hotel: 'ŸÅŸÜÿØŸÇ ÿßŸÑÿ¥ŸáÿØÿßÿ°', cost: 439 },
                { hotel: 'ŸÖŸàŸÅŸÜÿ®ŸäŸÉ Ÿáÿßÿ¨ÿ±', cost: 785 }, { hotel: 'ÿ®ŸàŸÑŸÖÿßŸÜ ÿ≤ŸÖÿ≤ŸÖ', cost: 780 },
                { hotel: 'ÿ¥Ÿäÿ±ÿßÿ™ŸàŸÜ ÿ¨ÿ®ŸÑ ÿßŸÑŸÉÿπÿ®ÿ©', cost: 400 }, { hotel: 'ŸÅŸäÿ±ŸÖŸàŸÜÿ™ ÿ≥ÿßÿπÿ© ŸÖŸÉÿ©', cost: 950 }
            ],
            makkahBudget: [
                { hotel: 'ÿ£ÿ®ÿ±ÿßÿ¨ ÿßŸÑŸÉÿ≥Ÿàÿ©', cost: 90 }, { hotel: 'ŸÜŸàÿßÿ≤Ÿä ÿ£ÿ¨ŸäÿßÿØ', cost: 123 },
                { hotel: 'ÿ•ÿπŸÖÿßÿ± ÿßŸÑÿÆŸÑŸäŸÑ', cost: 185 }, { hotel: 'ŸÅŸÜÿØŸÇ ŸÅŸÑÿ≥ÿ∑ŸäŸÜ', cost: 175 },
                { hotel: 'ŸÖŸÉÿßÿ±ŸÖ ÿßŸÑŸáÿ¨ÿ±ÿ©', cost: 150 }, { hotel: 'ÿ•ŸäŸÑÿßŸÅ ÿ®ŸÉÿ©', cost: 210 }
            ],
            makkahEvolution: {
                labels: ['ŸäŸàŸÑŸäŸà - ÿ£ÿ∫ÿ≥ÿ∑ÿ≥', 'ÿ≥ÿ®ÿ™ŸÖÿ®ÿ± - ÿ£ŸÉÿ™Ÿàÿ®ÿ±', 'ÿØŸäÿ≥ŸÖÿ®ÿ± - ŸäŸÜÿßŸäÿ±'],
                datasets: [
                    { hotel: 'ŸÅŸÜÿØŸÇ ÿßŸÑÿ¥ŸáÿØÿßÿ° (BB)', prices: [388, 500, 800] },
                    { hotel: 'ÿ•ÿπŸÖÿßÿ± ÿ¨ÿ±ÿßŸÜÿØ (BB)', prices: [280, 340, 490] },
                    { hotel: 'ŸÜŸàÿßÿ≤Ÿä ÿ£ÿ¨ŸäÿßÿØ (RO)', prices: [100, 135, 175] }
                ]
            },
            makkahMealPlans: { 'ÿ•ŸÅÿ∑ÿßÿ± ŸÅŸÇÿ∑ (BB)': 50, 'ÿ®ÿØŸàŸÜ Ÿàÿ¨ÿ®ÿßÿ™ (RO)': 40, 'ÿ¥ÿßŸÖŸÑ 3 Ÿàÿ¨ÿ®ÿßÿ™ (FB)': 10 },
            madinahHotels: [
                { hotel: 'ÿ®ŸàŸÑŸÖÿßŸÜ ÿ≤ŸÖÿ≤ŸÖ', cost: 550 }, { hotel: 'ŸÉÿ±ÿßŸàŸÜ ÿ®ŸÑÿßÿ≤ÿß', cost: 525 },
                { hotel: 'ÿØÿßÿ± ÿßŸÑÿ•ŸäŸÖÿßŸÜ ÿ•ŸÜÿ™ÿ±ŸÉŸàŸÜÿ™ŸäŸÜŸÜÿ™ÿßŸÑ', cost: 1108 }, { hotel: 'ŸÖŸàŸÅŸÜÿ®ŸäŸÉ ÿ£ŸÜŸàÿßÿ±', cost: 590 },
                { hotel: 'ŸÅÿ±ŸàŸÜÿ™ŸäŸÑ ÿßŸÑÿ≠ÿßÿ±ÿ´Ÿäÿ©', cost: 650 }, { hotel: 'ÿØŸÑÿ© ÿ∑Ÿäÿ®ÿ©', cost: 547 },
                { hotel: 'ÿ≥ÿ¨Ÿâ ÿßŸÑŸÖÿØŸäŸÜÿ©', cost: 455 }, { hotel: 'ÿ®ŸÜŸÜÿ≥ŸàŸÑÿß ŸàŸàÿ±ÿ´', cost: 650 },
                { hotel: 'ŸÉŸàŸÜŸÉŸàÿ±ÿØ ÿØÿßÿ± ÿßŸÑÿÆŸäÿ±', cost: 400 }, { hotel: 'ÿßŸÑÿ£ŸÜÿµÿßÿ± ÿ¨ŸàŸÑÿØŸÜ ÿ™ŸàŸÑŸäÿ®', cost: 378 }
            ],
            madinahValue: [
                { hotel: 'ÿ≥ÿ¨Ÿâ ÿßŸÑŸÖÿØŸäŸÜÿ©', price: 455, meal_plan: 'BB' }, { hotel: 'ÿ•ÿπŸÖÿßÿ± ÿ±ŸàŸäÿßŸÑ', price: 700, meal_plan: 'FB' },
                { hotel: 'ÿ®ŸàŸÑŸÖÿßŸÜ ÿ≤ŸÖÿ≤ŸÖ', price: 550, meal_plan: 'BB' }, { hotel: 'ŸÅÿ±ŸàŸÜÿ™ŸäŸÑ ÿßŸÑÿ≠ÿßÿ±ÿ´Ÿäÿ©', price: 650, meal_plan: 'BB' },
                { hotel: 'ÿØŸÑÿ© ÿ∑Ÿäÿ®ÿ©', price: 547, meal_plan: 'RO' }, { hotel: 'ŸÉŸàŸÜŸÉŸàÿ±ÿØ ÿØÿßÿ± ÿßŸÑÿÆŸäÿ±', price: 400, meal_plan: 'RO' },
                { hotel: 'ÿßŸÑÿ£ŸÜÿµÿßÿ± ÿ¨ŸàŸÑÿØŸÜ ÿ™ŸàŸÑŸäÿ®', price: 378, meal_plan: 'RO' }, { hotel: 'ŸÉÿ±ÿßŸàŸÜ ÿ®ŸÑÿßÿ≤ÿß', price: 525, meal_plan: 'RO' },
                { hotel: 'ŸÖŸàŸÅŸÜÿ®ŸäŸÉ ÿ£ŸÜŸàÿßÿ±', price: 590, meal_plan: 'BB' }
            ],
            supplierComparison: {
                labels: ['ŸÅÿ™ÿ±ÿ© ÿπÿßÿØŸäÿ© (ÿ£ÿ∫ÿ≥ÿ∑ÿ≥ - ÿ≥ÿ®ÿ™ŸÖÿ®ÿ±)', 'ŸÅÿ™ÿ±ÿ© ÿßŸÑÿ∞ÿ±Ÿàÿ© (ÿØŸäÿ≥ŸÖÿ®ÿ± - ŸäŸÜÿßŸäÿ±)'],
                datasets: [
                    { supplier: 'ŸÇÿßŸÅŸÑÿ© ÿßŸÑÿ™Ÿàÿ≠ŸäÿØ', prices: [450, 820] },
                    { supplier: 'ŸÖŸÇÿßŸÖ ÿßŸÑÿ∂ŸäÿßŸÅÿ©', prices: [500, 850] },
                    { supplier: 'ÿ®ÿßŸÑŸÖ ÿ±Ÿäÿ™ÿ¥ (ŸÖÿ®ÿßÿ¥ÿ±)', prices: [425, 800] }
                ]
            }
        };


        const tooltipCallback = {
            plugins: {
                tooltip: {
                    callbacks: {
                        title: function(tooltipItems) {
                            const item = tooltipItems[0];
                            let label = item.chart.data.labels[item.dataIndex];
                            if (Array.isArray(label)) { return label.join(' '); }
                            return label;
                        }
                    }
                },
                legend: { labels: { font: { family: 'Cairo', size: 14 } } }
            },
            scales: {
                y: { ticks: { font: { family: 'Cairo' } } },
                x: { ticks: { font: { family: 'Cairo' } } }
            }
        };

        function wrapLabel(label, maxLength = 16) {
            if (label.length <= maxLength) return label;
            const words = label.split(' ');
            const lines = [];
            let currentLine = '';
            words.forEach(word => {
                if ((currentLine + word).length > maxLength) {
                    lines.push(currentLine.trim());
                    currentLine = '';
                }
                currentLine += word + ' ';
            });
            lines.push(currentLine.trim());
            return lines;
        }

        // Makkah Premium Comparison
        new Chart(document.getElementById('makkahPremiumComparisonChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: reportData.makkahPremium.map(d => wrapLabel(d.hotel)),
                datasets: [{ label: 'ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿ™ŸÉŸÑŸÅÿ© (ÿ±ŸäÿßŸÑ ÿ≥ÿπŸàÿØŸä)', data: reportData.makkahPremium.map(d => d.cost), backgroundColor: chartColors }]
            },
            options: { ...tooltipCallback, responsive: true, maintainAspectRatio: false }
        });

        // Makkah Budget Comparison
        new Chart(document.getElementById('makkahBudgetComparisonChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: reportData.makkahBudget.map(d => d.hotel),
                datasets: [{ label: 'ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿ™ŸÉŸÑŸÅÿ© (ÿ±ŸäÿßŸÑ ÿ≥ÿπŸàÿØŸä)', data: reportData.makkahBudget.map(d => d.cost), backgroundColor: chartColors }]
            },
            options: { ...tooltipCallback, responsive: true, maintainAspectRatio: false, indexAxis: 'y' }
        });

        // Makkah Price Evolution
        new Chart(document.getElementById('makkahPriceEvolutionChart').getContext('2d'), {
            type: 'line',
            data: {
                labels: reportData.makkahEvolution.labels,
                datasets: reportData.makkahEvolution.datasets.map((d, i) => ({
                    label: d.hotel,
                    data: d.prices,
                    borderColor: chartColors[i],
                    backgroundColor: chartColors[i] + '33',
                    fill: true,
                    tension: 0.1
                }))
            },
            options: { ...tooltipCallback, responsive: true, maintainAspectRatio: false }
        });

        // Makkah Meal Plan Composition
        new Chart(document.getElementById('makkahMealPlanChart').getContext('2d'), {
            type: 'doughnut',
            data: {
                labels: Object.keys(reportData.makkahMealPlans),
                datasets: [{ data: Object.values(reportData.makkahMealPlans), backgroundColor: [brandPalette.gold, brandPalette.goldLight, brandPalette.accent], hoverOffset: 4 }]
            },
            options: { ...tooltipCallback, responsive: true, maintainAspectRatio: false }
        });

        // Madinah Comparison
        new Chart(document.getElementById('madinahComparisonChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: reportData.madinahHotels.map(d => wrapLabel(d.hotel)),
                datasets: [{ label: 'ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿ™ŸÉŸÑŸÅÿ© (ÿ±ŸäÿßŸÑ ÿ≥ÿπŸàÿØŸä)', data: reportData.madinahHotels.map(d => d.cost), backgroundColor: chartColors }]
            },
            options: { ...tooltipCallback, responsive: true, maintainAspectRatio: false }
        });

        // Madinah Value Scatter
        const mealPlanToValue = { 'RO': 1, 'BB': 2, 'HB': 3, 'FB': 4 };
        new Chart(document.getElementById('madinahValueChart').getContext('2d'), {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'ŸÅŸÜÿßÿØŸÇ ÿßŸÑŸÖÿØŸäŸÜÿ©',
                    data: reportData.madinahValue.map(d => ({
                        x: d.price,
                        y: mealPlanToValue[d.meal_plan],
                        label: `${d.hotel} (${d.meal_plan})`
                    })),
                    backgroundColor: chartColors, pointRadius: 8, pointHoverRadius: 12
                }]
            },
            options: {
                ...tooltipCallback, responsive: true, maintainAspectRatio: false,
                scales: {
                    x: { title: { display: true, text: 'ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿ≥ÿπÿ± (ÿ±ŸäÿßŸÑ ÿ≥ÿπŸàÿØŸä)', font: { family: 'Cairo' } } },
                    y: {
                        title: { display: true, text: 'ÿ®ÿßŸÇÿ© ÿßŸÑŸàÿ¨ÿ®ÿßÿ™', font: { family: 'Cairo' } },
                        ticks: { stepSize: 1, callback: (value) => ['','RO', 'BB', 'HB', 'FB'][value] || '' }
                    }
                },
                plugins: { tooltip: { callbacks: { label: (context) => context.raw.label, title: () => '' } } }
            }
        });

        // Supplier Comparison Chart
        new Chart(document.getElementById('supplierComparisonChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: reportData.supplierComparison.labels,
                datasets: reportData.supplierComparison.datasets.map((d, i) => ({
                    label: d.supplier,
                    data: d.prices,
                    backgroundColor: chartColors[i]
                }))
            },
            options: {
                ...tooltipCallback, responsive: true, maintainAspectRatio: false,
                scales: { y: { beginAtZero: true, title: { display: true, text: 'ÿßŸÑÿ≥ÿπÿ± (ÿ±ŸäÿßŸÑ ÿ≥ÿπŸàÿØŸä)', font: { family: 'Cairo' } } } }
            }
        });

        // Mobile nav toggle (accessibility-friendly)
        (function() {
            const navToggle = document.getElementById('navToggle');
            const navLinks = document.getElementById('navLinks');
            if (!navToggle || !navLinks) return;
            function setToggleIcon(open) {
                if (open) {
                    navToggle.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>';
                } else {
                    navToggle.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>';
                }
            }

            // initialize icon
            setToggleIcon(false);

            navToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                const expanded = navToggle.getAttribute('aria-expanded') === 'true';
                navToggle.setAttribute('aria-expanded', String(!expanded));
                navLinks.classList.toggle('show');
                setToggleIcon(!expanded);
            });
            // Close panel when clicking outside on mobile
            document.addEventListener('click', (e) => {
                if (window.innerWidth > 767) return;
                if (!navLinks.classList.contains('show')) return;
                const target = e.target;
                if (!navLinks.contains(target) && target !== navToggle) {
                    navLinks.classList.remove('show');
                    navToggle.setAttribute('aria-expanded', 'false');
                    setToggleIcon(false);
                }
            });
            // Close nav when resizing to desktop
                window.addEventListener('resize', () => {
                    if (window.innerWidth > 767 && navLinks.classList.contains('show')) {
                        navLinks.classList.remove('show');
                        navToggle.setAttribute('aria-expanded', 'false');
                        setToggleIcon(false);
                    }
                });
            })();

            // Touch-friendly dropdown for export button
            (function() {
                const dropdownButtons = document.querySelectorAll('.dropdown > button');
                dropdownButtons.forEach(btn => {
                    const menu = btn.nextElementSibling;
                    btn.addEventListener('click', e => {
                        e.stopPropagation();
                        menu.classList.toggle('show');
                    });
                });
                // Close dropdowns when clicking outside
                document.addEventListener('click', () => {
                    document.querySelectorAll('.dropdown-content.show').forEach(menu => menu.classList.remove('show'));
                });
            })();

            // Namespaced module: DataHub + AI Assistant (keeps variables local and avoids collisions)
            (function DataHubAIAgent() {
                const palette = ['#005f73', '#0a9396', '#94d2bd', '#e9d8a6', '#ee9b00', '#ca6702'];
                let activeRoomType = 'dbl'; // dbl | tpl | quad
                // Prefer global hotelData if present (non-destructive merge)
                let hotelData = (window.hotelData || []).map(h => ({
                    ...h,
                    price_dbl: h.price_dbl || h.price || null,
                    price_tpl: h.price_tpl || null,
                    price_quad: h.price_quad || null,
                    meal_plan_desc: h.meal_plan_desc || ''
                }));
                let charts = { dataHubChart: null };

                function renderTable(source) {
                    const rows = (source || hotelData) || [];
                    const tbody = document.getElementById('newDataTbody');
                    if (!tbody) return;
                    tbody.innerHTML = '';
                    rows.forEach((r) => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td class="p-2">${r.name || r.hotel || ''}</td>
                            <td class="p-2">${r.city || ''}</td>
                            <td class="p-2">${r.date_from || ''}</td>
                            <td class="p-2">${r.date_to || ''}</td>
                            <td class="p-2">${r.price_dbl ?? r.price ?? ''}</td>
                            <td class="p-2">${r.price_tpl ?? ''}</td>
                            <td class="p-2">${r.price_quad ?? ''}</td>
                            <td class="p-2">${r.meal_plan_desc || ''}</td>`;
                        tbody.appendChild(tr);
                    });
                }

                function destroyCharts() {
                    if (charts.dataHubChart) {
                        charts.dataHubChart.destroy();
                        charts.dataHubChart = null;
                    }
                }

                function buildDatasetByRoomType(roomType) {
                    return (hotelData || []).map(h => {
                        if (roomType === 'tpl') return h.price_tpl ?? null;
                        if (roomType === 'quad') return h.price_quad ?? null;
                        return h.price_dbl ?? h.price ?? null; // default dbl
                    });
                }

                function createCharts() {
                    const ctxEl = document.getElementById('dataHubComparisonChart');
                    if (!ctxEl) return;
                    const ctx = ctxEl.getContext('2d');
                    destroyCharts();
                    const labels = (hotelData || []).map(h => h.name || h.hotel || '');
                    const data = buildDatasetByRoomType(activeRoomType);
                    const labelMap = { dbl: 'ÿßŸÑÿ≥ÿπÿ± ÿ´ŸÜÿßÿ¶Ÿä DBL', tpl: 'ÿßŸÑÿ≥ÿπÿ± ÿ´ŸÑÿßÿ´Ÿä TRPL', quad: 'ÿßŸÑÿ≥ÿπÿ± ÿ±ÿ®ÿßÿπŸä QUAD' };
                    charts.dataHubChart = new Chart(ctx, {
                        type: 'bar',
                        data: { labels, datasets: [{ label: labelMap[activeRoomType], data, backgroundColor: palette }] },
                        options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
                    });
                }

                function setActiveRoomButton() {
                    document.querySelectorAll('[data-roomtype]').forEach(btn => {
                        if (btn.getAttribute('data-roomtype') === activeRoomType) {
                            btn.classList.add('bg-[var(--brand-gold)]','text-white');
                            btn.classList.remove('hover:bg-gray-100');
                        } else {
                            btn.classList.remove('bg-[var(--brand-gold)]','text-white');
                            btn.classList.add('hover:bg-gray-100');
                        }
                    });
                }

                document.querySelectorAll('[data-roomtype]')?.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const rt = btn.getAttribute('data-roomtype');
                        if (rt && rt !== activeRoomType) {
                            activeRoomType = rt;
                            setActiveRoomButton();
                            if (charts.dataHubChart) createCharts();
                        }
                    });
                });
                setActiveRoomButton();

                // Wire buttons: avoid double-binding if main page already defines handlers/inputs
                const addBtn = document.getElementById('addDataBtn');
                if (addBtn) {
                    addBtn.addEventListener('click', () => {
                        // If the global-form inputs exist (hotelNameInput etc), prefer the main page handler (do nothing here)
                        if (document.getElementById('hotelNameInput') && window.hotelData) {
                            // sync table from global data
                            hotelData = window.hotelData;
                            renderTable(hotelData);
                            return;
                        }

                        const name = (document.getElementById('newHotelName') || {}).value?.trim?.() || '';
                        const city = (document.getElementById('newHotelCity') || {}).value || '';
                        const date_from = (document.getElementById('newHotelDateFrom') || {}).value || '';
                        const date_to = (document.getElementById('newHotelDateTo') || {}).value || '';
                        const price_dbl = (document.getElementById('newPriceDbl') || {}).value ? Number(document.getElementById('newPriceDbl').value) : null;
                        const price_tpl = (document.getElementById('newPriceTpl') || {}).value ? Number(document.getElementById('newPriceTpl').value) : null;
                        const price_quad = (document.getElementById('newPriceQuad') || {}).value ? Number(document.getElementById('newPriceQuad').value) : null;
                        const meal_plan_desc = (document.getElementById('newMealPlanDesc') || {}).value || '';

                        if (!name || (!price_dbl && !price_tpl && !price_quad)) return alert('ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÅŸÜÿØŸÇ Ÿàÿ≥ÿπÿ± Ÿàÿßÿ≠ÿØ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ.');

                        const entry = { name, city, date_from, date_to, price_dbl, price_tpl, price_quad, meal_plan_desc };
                        // push to global if available, otherwise local
                        if (window.hotelData) {
                            window.hotelData.push(entry);
                            hotelData = window.hotelData;
                        } else {
                            hotelData.push(entry);
                        }
                        renderTable(hotelData);
                        // optional: auto-refresh chart if already drawn
                        if (charts.dataHubChart) createCharts();
                    });
                }

                const refreshBtn = document.getElementById('refreshChartsBtn');
                if (refreshBtn) {
                    refreshBtn.addEventListener('click', () => {
                        // If main createCharts exists, call it to refresh the full dashboard
                        if (typeof window.createCharts === 'function') {
                            // ensure global hotelData is synced
                            if (!window.hotelData && hotelData.length) window.hotelData = hotelData;
                            window.createCharts();
                        } else {
                            if ((hotelData || []).length === 0) return alert('ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ŸÑÿπÿ±ÿ∂Ÿáÿß. ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿ∂ÿßŸÅÿ© ÿµŸÅ ÿ®ŸäÿßŸÜÿßÿ™ ÿ£ŸàŸÑÿßŸã.');
                            // createCharts(); // This is now removed as there is no dedicated chart canvas anymore.
                        }
                    });
                }

                // Minimal Gemini API caller (placeholder). The API key is intentionally empty.
                async function callGeminiAPI(prompt) {
                    const apiUrl = ''; // ‚Üê ÿ∂ÿπ ÿπŸÜŸàÿßŸÜ ÿßŸÑÿÆÿßÿØŸÖ/ŸÜŸÇÿ∑ÿ© ÿßŸÑŸÜŸáÿßŸäÿ© ŸáŸÜÿß ÿ£Ÿà ÿßÿ™ÿ±ŸÉŸá ŸÅÿßÿ±ÿ∫Ÿãÿß ŸÑÿßÿÆÿ™ÿ®ÿßÿ±ÿßÿ™ ŸÖÿ≠ŸÑŸäÿ©
                    if (!apiUrl) return Promise.resolve('Ÿàÿ∂ÿπ ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä: ŸÖŸÅÿ™ÿßÿ≠/ŸÜŸÇÿ∑ÿ© ŸÜŸáÿßŸäÿ© Gemini ÿ∫Ÿäÿ± ŸÖÿ∂ÿ®Ÿàÿ∑ÿ©. ÿßŸÑÿµŸÇ ŸÖŸÅÿ™ÿßÿ≠ API ŸÅŸä ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ŸÑÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿ≠ŸÇŸäŸÇŸäÿ©.');
                    try {
                        const resp = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ prompt }) });
                        const json = await resp.json();
                        return json?.result || JSON.stringify(json);
                    } catch (err) {
                        return 'ŸÅÿ¥ŸÑ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÖÿ≤ŸàÿØ Gemini: ' + err.message;
                    }
                }

                document.getElementById('getMarketAnalysisBtn')?.addEventListener('click', async () => {
                    const out = document.getElementById('marketAnalysisResult');
                    const loader = document.getElementById('marketAnalysisLoader');
                    loader.classList.remove('hidden');
                    out.textContent = '';
                    const res = await callGeminiAPI('ÿßÿπÿ∑ŸÜŸä ŸÖŸÑÿÆÿµŸãÿß ÿ≥ÿ±ŸäÿπŸãÿß ÿπŸÜ ÿ≥ŸàŸÇ ŸÅŸÜÿßÿØŸÇ ŸÖŸÉÿ© ŸàÿßŸÑŸÖÿØŸäŸÜÿ© ŸÖÿπ ÿ™ŸàÿµŸäÿßÿ™ ÿ™ÿ≥ÿπŸäÿ±');
                    loader.classList.add('hidden');
                    out.textContent = res;
                });

                document.getElementById('getHotelRecommendationBtn')?.addEventListener('click', async () => {
                    const query = document.getElementById('hotelQueryInput').value.trim();
                    const out = document.getElementById('hotelRecommendationResult');
                    const loader = document.getElementById('hotelRecommendationLoader');
                    if (!query) return alert('ÿßŸÉÿ™ÿ® ÿ≥ÿ§ÿßŸÑŸÉ ÿ£ŸàŸÑÿßŸã.');
                    loader.classList.remove('hidden');
                    out.textContent = '';
                    const res = await callGeminiAPI(`ÿ£ÿ¨ÿ® ÿ®ÿßŸÇÿ™ÿ∂ÿßÿ® ÿπŸÜ: ${query}`);
                    loader.classList.add('hidden');
                    out.textContent = res;
                });

                // initialize with a few entries mapped from existing reportData (non-destructive)
                try {
                    if (window.reportData && Array.isArray(window.reportData.makkahPremium)) {
                        window.reportData.makkahPremium.slice(0,3).forEach(r => hotelData.push({ hotel: r.hotel, price_dbl: r.cost, city: 'Makkah' }));
                    }
                } catch (e) { /* ignore */ }
                renderTable();
            })();

        /* Insert Gemini API logic and button wiring (non-destructive) */
        (function GeminiModule(){
	// ÿ´Ÿàÿßÿ®ÿ™: ÿ∂ÿπ ŸÖŸÅÿ™ÿßÿ≠ API ŸáŸÜÿß ÿ£Ÿà ÿßÿ™ÿ±ŸÉŸá ŸÅÿßÿ±ÿ∫ÿßŸã ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿ™ÿ∑ŸàŸäÿ±
	const apiKey = "AIzaSyBPTaGsM4-dr7JnHUHDKJe87MSLtfkaCfw"; // ‚Üê ÿ∂ÿπ ÿßŸÑŸÖŸÅÿ™ÿßÿ≠ ŸáŸÜÿß
	const apiUrlBase = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent`;
	const hasApiKey = Boolean(apiKey && apiKey.trim().length > 0);

	// ŸÑÿ™ÿ¨ŸÜÿ® ÿ∑ÿ®ÿßÿπÿ© ŸÜŸÅÿ≥ ÿßŸÑÿÆÿ∑ÿ£ ÿπÿØÿ© ŸÖÿ±ÿßÿ™
	let logged403 = false;

	/**
	 * ÿØÿßŸÑÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ŸÄ Gemini ŸÖÿπ retry Ÿà exponential backoff.
	 * ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸèÿ∂ÿ®ÿ∑ apiKey ŸÅÿ•ŸÜŸáÿß ÿ™ŸèÿπŸäÿØ ÿ±ÿ≥ÿßŸÑÿ© ÿ™Ÿàÿ∂Ÿäÿ≠Ÿäÿ© ÿØŸàŸÜ ÿ™ŸÜŸÅŸäÿ∞ fetch.
	 */
	async function callGeminiAPI_Gemini(prompt, maxRetries = 3) {
		// ÿ•ÿ∞ÿß ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿπŸäŸäŸÜ apiKeyÿå ÿ£ÿπÿØ ÿ±ÿ≥ÿßŸÑÿ© Ÿàÿßÿ∂ÿ≠ÿ© ŸÖÿ®ÿßÿ¥ÿ±ÿ© (ŸÑÿß ÿ™ÿ≠ÿßŸàŸÑ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™)
		if (!hasApiKey) {
			return "ŸÖŸÑÿßÿ≠ÿ∏ÿ©: ŸÑŸÖ Ÿäÿ™ŸÖ ÿ•ÿπÿØÿßÿØ ŸÖŸÅÿ™ÿßÿ≠ API ŸÑŸÄ Gemini. ÿ∂ÿπ ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ± apiKey ÿØÿßÿÆŸÑ ÿßŸÑŸÉŸàÿØ ŸÑÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÖŸÉÿßŸÑŸÖÿßÿ™ ÿßŸÑÿ≠ŸÇŸäŸÇŸäÿ©.";
		}

		const apiUrl = `${apiUrlBase}?key=${encodeURIComponent(apiKey)}`;
		const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
		const payload = { contents: chatHistory };

		let attempt = 0;
		while (attempt < maxRetries) {
			try {
				const response = await fetch(apiUrl, {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify(payload)
				});

				// ÿ™ÿπÿßŸÖŸÑ ŸÖÿÆÿµÿµ ŸÖÿπ ÿ≠ÿßŸÑÿ© 403 ŸÑÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ŸÖŸÅŸäÿØÿ©
				if (response.status === 403) {
					if (!logged403) {
						console.warn('Gemini API returned 403. ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ŸÖŸÅÿ™ÿßÿ≠ API/ÿ£ÿ∞ŸàŸÜÿßÿ™ ÿßŸÑÿ≠ÿ≥ÿßÿ®.');
						logged403 = true;
					}
					return "ŸÅÿ¥ŸÑ ÿßŸÑÿßÿ™ÿµÿßŸÑ: ŸàÿµŸàŸÑ ŸÖÿ±ŸÅŸàÿ∂ (403). ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿµÿ≠ÿ© ŸÖŸÅÿ™ÿßÿ≠ API Ÿàÿ£ÿ∞ŸàŸÜÿßÿ™ ŸÖÿ¥ÿ±Ÿàÿπ Google Cloud.";
				}

				if (!response.ok) {
					throw new Error(`HTTP error! status: ${response.status}`);
				}

				const result = await response.json();

				// ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿßŸÑŸÜÿµ ÿ®ÿ£ŸÖÿßŸÜ
				const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;
				if (text) return text;

				throw new Error('Invalid API response structure');
			} catch (error) {
				attempt++;
				if (attempt >= maxRetries) {
					console.error('Gemini API call failed:', error);
					return "ÿπÿ∞ÿ±ÿßŸãÿå ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ŸÖÿ≠ÿßŸàŸÑÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÑÿßÿ≠ŸÇŸãÿß.";
				}
				// exponential backoff
				await new Promise(res => setTimeout(res, Math.pow(2, attempt) * 1000));
			}
		}
	}

	// ÿßÿπÿ±ÿ∂ ÿßŸÑÿØÿßŸÑÿ© ÿπÿßŸÑŸÖŸäŸãÿß ŸÑŸÑŸàÿµŸàŸÑ ÿßŸÑŸäÿØŸàŸä ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿ™ÿ∑ŸàŸäÿ±
	window.callGeminiAPI_Gemini = callGeminiAPI_Gemini;

	// ÿ±ÿ®ÿ∑ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± (ŸÑÿß ÿ™ÿ∫ŸäŸëÿ± ÿßŸÑÿ®ŸÜŸäÿ© ÿßŸÑŸÖÿ±ÿ¶Ÿäÿ©)
	function wireButtons(){
		const marketBtnEl = document.getElementById('getMarketAnalysisBtn');
		const hotelBtnEl = document.getElementById('getHotelRecommendationBtn');
		if(!marketBtnEl || !hotelBtnEl) return;

		// ÿßÿ≥ÿ™ŸÜÿ≥ÿßÿÆ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ŸÑÿ•ÿ≤ÿßŸÑÿ© ŸÖÿ≥ÿ™ŸÖÿπŸä ÿ£ÿ≠ÿØÿßÿ´ ŸÇÿØŸäŸÖÿ© (non-destructive)
		const marketBtn = marketBtnEl.cloneNode(true);
		marketBtnEl.parentNode.replaceChild(marketBtn, marketBtnEl);

		const hotelBtn = hotelBtnEl.cloneNode(true);
		hotelBtnEl.parentNode.replaceChild(hotelBtn, hotelBtnEl);

		const marketLoader = document.getElementById('marketAnalysisLoader');
		const marketResult = document.getElementById('marketAnalysisResult');

		const hotelLoader = document.getElementById('hotelRecommendationLoader');
		const hotelResult = document.getElementById('hotelRecommendationResult');
		const hotelQueryInput = document.getElementById('hotelQueryInput');

		// ÿ≤ÿ± ÿ™ÿ≠ŸÑŸäŸÄŸÑ ÿßŸÑÿ≥ŸàŸÇ
		marketBtn.addEventListener('click', async () => {
			if (marketLoader) marketLoader.classList.remove('hidden');
			marketBtn.disabled = true;
			if (marketResult) marketResult.textContent = '';

			const prompt = `
                ÿ®ÿµŸÅÿ™ŸÉ ÿÆÿ®Ÿäÿ±Ÿãÿß ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿ£ÿ≥ŸàÿßŸÇ ÿßŸÑÿ≥Ÿäÿßÿ≠ÿ© ÿßŸÑÿØŸäŸÜŸäÿ©ÿå ŸÇŸÖ ÿ®ÿ™ŸÇÿØŸäŸÖ ŸÖŸÑÿÆÿµ ÿ™ÿ≠ŸÑŸäŸÑŸä ŸÖŸàÿ¨ÿ≤ ŸÑÿ≥ŸàŸÇ ŸÅŸÜÿßÿØŸÇ ÿßŸÑÿπŸÖÿ±ÿ© ŸÑŸÖŸàÿ≥ŸÖ 1447ŸáŸÄ ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿπÿ±Ÿàÿ∂ÿ©. ÿßÿ∞ŸÉÿ± ÿ£ŸáŸÖ ÿßŸÑŸÅÿ±ÿµ ŸàÿßŸÑÿ™ÿ≠ÿØŸäÿßÿ™ ŸÑŸàŸÉŸÑÿßÿ° ÿßŸÑÿ≥ŸÅÿ±.
            `;
			const analysis = await callGeminiAPI_Gemini(prompt);

			if (marketResult) marketResult.textContent = analysis;
			if (marketLoader) marketLoader.classList.add('hidden');
			marketBtn.disabled = false;
		});

		// ÿ≤ÿ± ÿ∑ŸÑÿ® ÿ™ŸàÿµŸäÿ© ŸÅŸÜÿØŸÇŸäÿ©
		hotelBtn.addEventListener('click', async () => {
			const query = hotelQueryInput ? hotelQueryInput.value : '';
			if (!query || !query.trim()) {
				alert('ÿßŸÉÿ™ÿ® ÿ≥ÿ§ÿßŸÑŸÉ ÿ£ŸàŸÑÿßŸã.');
				return;
			}
			if (hotelLoader) hotelLoader.classList.remove('hidden');
			hotelBtn.disabled = true;
			if (hotelResult) hotelResult.textContent = '';

			const hotelDataString = JSON.stringify(window.hotelData || []);

			const prompt = `
                ÿ£ŸÜÿ™ ÿÆÿ®Ÿäÿ± ŸÅŸä ÿ≠ÿ¨Ÿàÿ≤ÿßÿ™ ŸÅŸÜÿßÿØŸÇ ÿßŸÑÿπŸÖÿ±ÿ©. ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿ∑ŸÑÿ® ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ™ÿßŸÑŸäÿå Ÿàÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÅŸÜÿßÿØŸÇ ÿßŸÑŸÖÿ™ŸàŸÅÿ±ÿ© Ÿáÿ∞Ÿá ŸÅŸÇÿ∑ÿå ŸÇŸÖ ÿ®ÿ™ŸÇÿØŸäŸÖ ÿ™ŸàÿµŸäÿ© ŸÑÿ£ŸÅÿ∂ŸÑ ŸÅŸÜÿØŸÇ ÿ£Ÿà ŸÅŸÜÿØŸÇŸäŸÜ ŸÖÿπ ÿ∞ŸÉÿ± ÿßŸÑÿ≥ÿ®ÿ®.

                ÿ∑ŸÑÿ® ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ: "${query}"

                ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÅŸÜÿßÿØŸÇ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ© (ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ŸÑÿ∫ÿ±ŸÅÿ© ÿ´ŸÜÿßÿ¶Ÿäÿ©): ${hotelDataString}

                Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ ÿ•ÿ¨ÿßÿ®ÿ™ŸÉ ÿ®ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ©ÿå ŸàÿØŸàÿØÿ©ÿå ŸàŸÖŸàÿ¨ÿ≤ÿ©.
            `;
			const recommendation = await callGeminiAPI_Gemini(prompt);

			if (hotelResult) hotelResult.textContent = recommendation;
			if (hotelLoader) hotelLoader.classList.add('hidden');
			hotelBtn.disabled = false;
		});
	}

	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', wireButtons);
	} else {
		wireButtons();
	}
})(); 

// ...existing code...
        // === Hijri / Gregorian Calendar Toggle (ŸÖÿ≠ÿ≥ŸëŸÜ + fallback ÿ®ÿØŸàŸÜ moment-hijri) ===
        (function calendarModeModule(){
            const modeButtons = document.querySelectorAll('[data-calmode]');
            const gregFrom = document.getElementById('newHotelDateFrom');
            const gregTo = document.getElementById('newHotelDateTo');
            const hijriWrap = document.getElementById('hijriInputs');
            const hijriFrom = document.getElementById('newHotelDateFromHijri');
            const hijriTo = document.getElementById('newHotelDateToHijri');
            const hijriYear = document.getElementById('hijriYear');
            const warn = document.getElementById('hijriLibWarn');
            if(!modeButtons.length) return;

            const momentLoaded = (typeof moment !== 'undefined');
            const momentHijri = momentLoaded && typeof moment().iYear === 'function';
            const hijriDateLoaded = (typeof HijriDate !== 'undefined');
            const hijriSupported = momentHijri || hijriDateLoaded; // true if we can provide user-friendly conversion

            // Fallback: JD-based conversions (from common algorithms)
            function gregorianToJD(y,m,d){
                // Fliegel & Van Flandern
                const a = Math.floor((14 - m)/12);
                const y2 = y + 4800 - a;
                const m2 = m + 12*a - 3;
                return d + Math.floor((153*m2 + 2)/5) + 365*y2 + Math.floor(y2/4) - Math.floor(y2/100) + Math.floor(y2/400) - 32045;
            }
            function jdToGregorian(jd){
                // Fliegel & Van Flandern inverse
                let l = jd + 68569;
                const n = Math.floor((4*l) / 146097);
                l = l - Math.floor((146097*n + 3)/4);
                const i = Math.floor((4000*(l+1)) / 1461001);
                l = l - Math.floor((1461*i)/4) + 31;
                const j = Math.floor((80*l)/2447);
                const day = l - Math.floor((2447*j)/80);
                l = Math.floor(j/11);
                const month = j + 2 - 12*l;
                const year = 100*(n - 49) + i + l;
                // return yyyy-mm-dd
                const mm = month < 10 ? '0'+month : ''+month;
                const dd = day < 10 ? '0'+day : ''+day;
                return `${year}-${mm}-${dd}`;
            }
            function islamicToJD(y,m,d){
                // arithmetic Islamic calendar to JD (tabular)
                return Math.floor((11*y + 3) / 30) + 354*(y-1) + 30*(m-1) - Math.floor((m-1)/2) + d + 1948440 - 385;
            }
            function jdToIslamic(jd){
                // convert JD to Islamic date (arithmetical)
                let l = jd - 1948440 + 10632;
                const n = Math.floor((l - 1) / 10631);
                l = l - 10631*n + 354;
                let j = (Math.floor((10985 - l)/5316))*(Math.floor((50*l)/17719)) + (Math.floor(l/5670))*(Math.floor((43*l)/15238));
                l = l - (Math.floor((30 - j)/15))*(Math.floor((17719*j)/50)) - Math.floor(j/16) + 29;
                const m = Math.floor((24*l)/709);
                const d = l - Math.floor((709*m)/24);
                const y = 30*n + j - 30;
                const mm = m < 10 ? '0'+m : ''+m;
                const dd = d < 10 ? '0'+d : ''+d;
                return `${dd}/${mm}/${y}`;
            }

            // gregorian yyyy-mm-dd -> hijri dd/mm/yyyy
            function gregToHijri_Fallback(gDate){
                if(!gDate) return '';
                const parts = gDate.split('-');
                if(parts.length<3) return '';
                const y = parseInt(parts[0],10), m = parseInt(parts[1],10), d = parseInt(parts[2],10);
                const jd = gregorianToJD(y,m,d);
                return jdToIslamic(jd);
            }

            // hijri string dd/mm[/yyyy] -> greg yyyy-mm-dd
            function hijriToGreg_Fallback(hStr){
                if(!hStr) return null;
                const parts = hStr.trim().split('/');
                if(parts.length < 2) return null;
                let d = parseInt(parts[0],10);
                let m = parseInt(parts[1],10);
                let y = parts[2] ? parseInt(parts[2],10) : (hijriYear && +hijriYear.value ? +hijriYear.value : 1447);
                if(!(d>0 && m>0 && y>0)) return null;
                const jd = islamicToJD(y,m,d);
                return jdToGregorian(jd);
            }

            // UI initialisation: prefer moment-hijri, else hijri-date, else show fallback note
            if (momentHijri) {
                if (warn) warn.style.display = 'none';
                if (hijriYear && !hijriYear.value) hijriYear.value = moment().iYear();
            } else if (hijriDateLoaded) {
                if (warn) { warn.textContent = 'note: moment-hijri ÿ∫Ÿäÿ± ŸÖÿ™ÿßÿ≠ ‚Äî ÿ≥Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ hijri-date ŸÑŸÑÿπÿ±ÿ∂.'; warn.style.display = 'inline-block'; }
                try {
                    if (hijriYear && !hijriYear.value) {
                        const hd = new HijriDate(); // today
                       
                        // hijri-date exposes year/month/day properties in many builds
                        hijriYear.value = hd.year ?? hd.yearNumber ?? (new Date().getFullYear() - 579);
                    }
                } catch (e) {
                    if (hijriYear && !hijriYear.value) hijriYear.value = new Date().getFullYear() - 579;
                }
            } else {
                if (warn) { warn.textContent = 'ŸÖŸÑÿßÿ≠ÿ∏ÿ©: moment-hijri / hijri-date ÿ∫Ÿäÿ± ŸÖÿ™ÿßÿ≠ÿ©ÿå ÿ≥Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ™ÿ≠ŸàŸäŸÑ ÿØÿßÿÆŸÑŸä (ÿ™ŸÇÿ±Ÿäÿ®Ÿä).'; warn.style.display = 'inline-block'; }
                if (hijriYear && !hijriYear.value) hijriYear.value = new Date().getFullYear() - 579;
            }

            function pad(n){ return n<10 ? '0'+n : ''+n; }

            function gregToHijri(gDate){
                // prefer moment-hijri, else hijri-date, else fallback
                if (momentHijri) {
                    const m = moment(gDate,'YYYY-MM-DD');
                    if(!m.isValid()) return '';
                    return `${pad(m.iDate())}/${pad(m.iMonth()+1)}/${m.iYear()}`;
                }
                if (hijriDateLoaded) {
                    try {
                        // use en-GB to get dd/mm/yyyy numeric format, with islamic calendar
                        const hd = new HijriDate(new Date(gDate));
                        const s = hd.toLocaleDateString('en-GB-u-ca-islamic-umalqura'); // e.g. 10/02/1447
                        return s;
                    } catch (e) {
                        return gregToHijri_Fallback(gDate);
                    }
                }
                return gregToHijri_Fallback(gDate);
            }
            function hijriToGreg(hStr){
                // prefer moment-hijri for accurate conversion; if missing use fallback arithmetic conversion
                if (momentHijri) {
                    const parts = hStr.trim().split('/');
                    if(parts.length<2) return null;
                    let [dd,mm,yy] = parts;
                    if(!yy) yy = (hijriYear && hijriYear.value) ? hijriYear.value : moment().iYear();
                    const mObj = moment(`${yy}-${mm}-${dd}`, 'iYYYY-iM-iD');
                    return mObj.isValid() ? mObj.format('YYYY-MM-DD') : null;
                }
                // hijri-date library does not provide a stable direct hijri->greg convert in all builds here,
                // so use the JD fallback which was already implemented for accuracy.
                return hijriToGreg_Fallback(hStr);
            }

            function attachHijriHandler(src, target){
                if(!src || !target) return;
                src.addEventListener('blur', ()=>{
                    const g = hijriToGreg(src.value);
                    if(g) target.value = g;
                });
            }
            attachHijriHandler(hijriFrom, gregFrom);
            attachHijriHandler(hijriTo, gregTo);
            hijriYear && hijriYear.addEventListener('blur', ()=>{
                hijriFrom && hijriFrom.dispatchEvent(new Event('blur'));
                hijriTo && hijriTo.dispatchEvent(new Event('blur'));
            });

            function updateAria(mode){
                modeButtons.forEach(b=>{
                    const active = b.getAttribute('data-calmode')===mode;
                    b.classList.toggle('active', active);
                    b.setAttribute('aria-pressed', active?'true':'false');
                });
            }

            function setActive(mode){
                updateAria(mode);
                if(mode === 'hijri'){
                    hijriWrap.classList.remove('hidden');
                    gregFrom.classList.add('hidden');
                    gregTo.classList.add('hidden');
                    if(hijriSupported){
                        if(gregFrom.value && !hijriFrom.value) hijriFrom.value = gregToHijri(gregFrom.value);
                        if(gregTo.value && !hijriTo.value) hijriTo.value = gregToHijri(gregTo.value);
                    } else {
                        if(gregFrom.value && !hijriFrom.value) hijriFrom.value = gregToHijri_Fallback(gregFrom.value);
                        if(gregTo.value && !hijriTo.value) hijriTo.value = gregToHijri_Fallback(gregTo.value);
                    }
                } else {
                    hijriWrap.classList.add('hidden');
                    gregFrom.classList.remove('hidden');
                    gregTo.classList.remove('hidden');
                    if(hijriFrom.value) hijriFrom.dispatchEvent(new Event('blur'));
                    if(hijriTo.value) hijriTo.dispatchEvent(new Event('blur'));
                }
                localStorage.setItem('calendarMode', mode);
            }

            modeButtons.forEach(btn=>{
                btn.addEventListener('click', ()=>{
                    const mode = btn.getAttribute('data-calmode');
                    if(!mode) return;
                    setActive(mode);
                });
            });

            setActive(localStorage.getItem('calendarMode') || 'greg');
        })();
        // === End Hijri / Gregorian Calendar Toggle ===
    </script>
</body>
</html>