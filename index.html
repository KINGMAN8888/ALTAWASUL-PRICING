<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุดุฑูุฉ ุงูุชูุงุตู ุงูุนุงููู - ุงูุชุญููู ุงูุงุณุชุฑุงุชูุฌู ูุฃุณุนุงุฑ ููุงุฏู ุงูุนูุฑุฉ 1447ูู</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>๐</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Removed export-related libraries: html2canvas, jspdf, xlsx, jszip, FileSaver -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/moment@2.30.1/min/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment-hijri@2.1.2/build/moment-hijri.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hijri-date/dist/hijri-date.js"></script>
    <style>
        :root {
            /* Brand palette derived from provided logos (gold / dark brown) */
            --brand-gold: #b8862f; /* primary gold */
            --brand-gold-light: #d4af37;
            --brand-dark: #3a2d1f; /* Deeper brown for text */
            --brand-background: #fdfcf9; /* Softer, warmer background */
            --brand-card-bg: #ffffff;
            --brand-accent: #8c6c2f;
            --brand-muted-text: #6e6051;
            --brand-muted: #f7f6f4; /* fallback muted background */
        }

        /* Base typography & layout */
        html, body {
            height: 100%;
            font-family: 'Cairo', sans-serif;
            scroll-behavior: smooth;
            background-color: var(--brand-background);
            color: var(--brand-dark);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Cards */
        .section-card {
            background-color: var(--brand-card-bg);
            border-radius: 1rem;
            padding: 2.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.04);
            border: 1px solid #e5e7eb;
            transition: transform 0.25s ease, box-shadow 0.25s ease;
        }
        .section-card:hover { transform: translateY(-6px); box-shadow: 0 18px 24px -8px rgba(58,45,31,0.08); }

        h1, h2, h3 { color: var(--brand-dark); line-height: 1.15; }

        /* Chart container responsive sizing */
        .chart-container {
            position: relative;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
            height: min(46vh, 420px);
            max-width: 900px;
        }

        /* Header / nav styles */
        .brand-logo { height: 72px; width: auto; }
        .sticky-nav { position: sticky; top: 0; z-index: 60; backdrop-filter: blur(6px); }

        /* ToTop button (RTL left) */
        #toTopBtn { position: fixed; bottom: 20px; left: 20px; display: none; z-index: 100; transition: opacity 0.3s, transform 0.3s; opacity: 0; transform: translateY(10px); }
        #toTopBtn.show { display: block; opacity: 1; transform: translateY(0); }

        /* Dropdown exports */
        .dropdown { position: relative; display: inline-block; }
        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;      /* align below the button */
            right: 0;
            background-color: #fff;
            min-width: 220px;
            margin-top: 0.25rem;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            z-index: 120;
            border-radius: 0.5rem;
        }
        .dropdown-content a { color: var(--brand-dark); padding: 12px 16px; text-decoration: none; display: block; text-align: right; transition: background-color 0.18s, color 0.18s; }
        .dropdown-content a:hover { background-color: var(--brand-dark); color: var(--brand-gold); }
    .dropdown:hover .dropdown-content { display: block; }
    /* show dropdown on click for touch devices */
    .dropdown-content.show { display: block !important; }

        /* NAV responsive behavior: mobile toggle + animated panel */
        #navToggle { display: inline-flex; align-items: center; justify-content: center; background: transparent; border: none; cursor: pointer; }
        #navLinks { display: flex; gap: 1.5rem; align-items: center; }

        /* Mobile-specific: collapse nav links into full-width sliding panel */
        @media (max-width: 767px) {
            .brand-logo { height: 56px; }
            header h1 { font-size: clamp(1.25rem, 4vw, 2rem); }
            .section-card { padding: 1.25rem; }
            .chart-container { height: 34vh; max-width: 100%; }

            /* The panel becomes a vertical, sliding dropdown below the nav */
            #navLinks {
                position: absolute;
                right: 0;
                left: 0;
                top: 100%;
                background: linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.995));
                flex-direction: column;
                gap: 0;
                align-items: stretch;
                padding: 0.5rem 0.75rem;
                border-top: 1px solid rgba(0,0,0,0.04);
                overflow: visible; /* allow dropdowns to overflow */
                max-height: 0; /* collapsed */
                opacity: 0;
                transform-origin: top right;
                transform: translateY(-6px);
                transition: max-height 320ms cubic-bezier(.2,.9,.2,1), opacity 220ms ease, transform 260ms cubic-bezier(.2,.9,.2,1);
                z-index: 70;
            }
            #navLinks a { padding: 0.75rem 1rem; border-radius: 0.5rem; color: var(--brand-dark); }
            #navLinks .dropdown { margin: 0.5rem 1rem; }
            #navLinks.show { max-height: 420px; opacity: 1; transform: translateY(0); }

            /* Slight padding on container for mobile */
            .sticky-nav .container { padding-left: 0.75rem; padding-right: 0.75rem; }
        }

        /* Tablet and up: comfortable spacing */
        @media (min-width: 768px) and (max-width: 1023px) {
            .chart-container { height: 38vh; max-width: 780px; }
            .brand-logo { height: 64px; }
            .section-card { padding: 1.5rem; }
        }

        /* Desktop large screens */
        @media (min-width: 1024px) {
            .chart-container { height: 46vh; max-width: 1100px; }
            .brand-logo { height: 80px; }
            .section-card { padding: 2.5rem; }
        }

        /* Small visual refinements */
        .sticky-nav a:hover { color: var(--brand-gold); }
        .sticky-nav .dropdown button { background-color: var(--brand-dark) !important; }
        .sticky-nav .dropdown button:hover { background-color: var(--brand-accent) !important; }

        /* ุงุณุชุจุฏุงู @apply ุจุชูุณูู ุซุงุจุช ูุฃู CDN ูุง ูุฏุนู @apply */
        .cal-mode-btn {
            padding:0.45rem 0.8rem;
            font-size:11px;
            font-weight:600;
            border:1px solid #d1d5db;
            background:#fff;
            border-radius:0.5rem;
            cursor:pointer;
            line-height:1;
            display:inline-flex;
            align-items:center;
            gap:.35rem;
            transition:.18s background-color,.18s color,.18s border-color,.18s box-shadow;
        }
        .cal-mode-btn:hover { background:#f3f4f6; }
        .cal-mode-btn.active {
            background:var(--brand-gold);
            color:#fff;
            border-color:var(--brand-gold);
            box-shadow:0 0 0 1px var(--brand-gold-light) inset;
        }
        .hijri-warning {
            font-size:11px;
            color:#b45309;
            background:#fff7ed;
            border:1px solid #fcd9b6;
            padding:.4rem .6rem;
            border-radius:.5rem;
            display:none;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Palette: Brilliant Blues -->
    <!-- #005f73, #0a9396, #94d2bd, #e9d8a6, #ee9b00, #ca6702, #bb3e03, #ae2012, #9b2226 -->
    <!-- Confirmation: NEITHER Mermaid JS NOR SVG were used in this output. -->
    <!-- 
        Narrative Plan:
        1.  Introduction: Set the stage for the 1447H Umrah hotel market analysis.
        2.  Makkah Market: Analyze premium and budget hotel costs, price evolution, and meal plan composition.
        3.  Madinah Market: Compare key hotels on price and analyze value using a scatter plot.
        4.  Supplier Analysis: Compare prices from different suppliers for the same hotel.
        5.  Seasonal Peaks: Highlight price surges during peak periods for both cities.
        6.  Key Insights: Provide expanded, actionable takeaways and pricing advice.
        
        Visualization Choices:
        -   Makkah Premium Hotel Costs -> Bar Chart (Goal: Compare) -> Implemented with Chart.js.
        -   Makkah Budget Hotel Costs -> Bar Chart (Goal: Compare) -> Implemented with Chart.js.
        -   Makkah Price Evolution -> Line Chart (Goal: Show Change) -> Implemented with Chart.js.
        -   Makkah Meal Plan Composition -> Doughnut Chart (Goal: Show Composition) -> Implemented with Chart.js.
        -   Madinah Hotel Costs -> Bar Chart (Goal: Compare) -> Implemented with Chart.js.
        -   Madinah Value Analysis -> Scatter Plot (Goal: Reveal Relationships) -> Implemented with Chart.js.
        -   Supplier Price Comparison -> Grouped Bar Chart (Goal: Compare) -> Implemented with Chart.js.
        -   Seasonal Peaks -> Styled List (Goal: Organize/Inform) -> Implemented with HTML/Tailwind.
        -   Key Takeaways -> Styled List (Goal: Organize/Inform) -> Implemented with HTML/Tailwind.
    -->

    <nav class="sticky-nav bg-[var(--brand-card-bg)]/80 backdrop-blur-md shadow-md">
        <div class="container mx-auto px-4">
            <div class="flex justify-center items-center h-24"> <!-- Increased height -->
                <div class="flex items-center gap-4">
                    <img src="./logo1.png" alt="ุดุนุงุฑ ุดุฑูุฉ ุงูุชูุงุตู ุงูุนุงููู" class="brand-logo h-16"> <!-- Adjusted size -->
                    <div>
                        <h1 class="text-2xl font-extrabold" style="color: var(--brand-dark);">ุดุฑูุฉ ุงูุชูุงุตู ุงูุนุงููู</h1>
                        <p class="text-xs" style="color: var(--brand-muted-text);">ูุชุญููู ุฃุณุนุงุฑ ุงูููุงุฏู</p>
                    </div>
                </div>
                <div class="flex-grow"></div>
                <!-- Desktop links (hidden on mobile) -->
                <div id="navLinks" class="flex items-center space-x-6">
                    <a href="#makkah" class="text-gray-600 hover:text-[var(--brand-gold)] font-semibold transition">ุชุญููู ููุฉ</a>
                    <a href="#madinah" class="text-gray-600 hover:text-[var(--brand-gold)] font-semibold transition">ุชุญููู ุงููุฏููุฉ</a>
                    <a href="#suppliers" class="text-gray-600 hover:text-[var(--brand-gold)] font-semibold transition">ุชุญููู ุงูููุฑุฏูู</a>
                    <a href="#peaks" class="text-gray-600 hover:text-[var(--brand-gold)] font-semibold transition">ูุชุฑุงุช ุงูุฐุฑูุฉ</a>
                    <a href="#takeaways" class="text-gray-600 hover:text-[var(--brand-gold)] font-semibold transition">ุงูุชูุตูุงุช ุงูููุงุฆูุฉ</a>
                    <!-- Export Button Dropdown -->
                    <div class="dropdown">
                        <button class="text-white font-bold py-2 px-4 rounded-lg transition inline-flex items-center" style="background:var(--brand-dark);">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                            <span>ุชูุฒูู ุงููููุงุช</span>
                        </button>
                        <div class="dropdown-content">
                            <a href="/ุงุณุนุงุฑ ููุงุฏู ุงููุฏููุฉ ุงููููุฑุฉ 1447ูู.xlsx" download>ุงุณุนุงุฑ ููุงุฏู ุงููุฏููุฉ ุงููููุฑุฉ 1447ูู Excel</a>
                            <a href="/ุงุณุนุงุฑ ููุงุฏู ููุฉ ุงูููุฑูุฉ 1447ูู.xlsx" download>ุงุณุนุงุฑ ููุงุฏู ููุฉ ุงูููุฑูุฉ 1447ูู Excel</a>
                            <a href="/ุงูุชุญููู ุงูููุณุน ูุงูุงุฎูุฑ.docx" download>ุชุญููู ุดุงูู ููุงุณุนุงุฑ WORD</a>
                        </div>
                    </div>
                </div>
                <!-- Mobile toggle button -->
                <button id="navToggle" aria-expanded="false" aria-controls="navLinks" aria-label="ูุงุฆูุฉ ุงูุชููู" class="ml-4" role="button">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>
        </div>
    </nav>

    <div id="top" class="container mx-auto p-4 md:p-8">

                <header class="text-center my-10 bg-white p-8 rounded-xl shadow-lg relative overflow-hidden" style="border-top: 5px solid var(--brand-gold);">
                        <div class="absolute inset-0 pointer-events-none opacity-10 bg-gradient-to-bl from-[var(--brand-gold-light)] via-transparent to-[var(--brand-accent)]"></div>
                        <h1 class="text-4xl md:text-6xl font-extrabold mb-3 relative" style="color: var(--brand-dark);">ุงูุชุญููู ุงูุงุณุชุฑุงุชูุฌู ูุฃุณุนุงุฑ ููุงุฏู ุงูุนูุฑุฉ 1447ูู</h1>
                        <p class="text-xl relative" style="color: var(--brand-muted-text);">ููุญุฉ ุจูุงูุงุช ุชูุงุนููุฉ ูุงุชุฎุงุฐ ูุฑุงุฑุงุช ุชุณุนูุฑ ูุฏุฑูุณุฉ ูู ููุฉ ูุงููุฏููุฉ</p>
                        <p id="hijri-date" class="mt-4 text-sm text-gray-600"></p>
                </header>

                <!-- Top Utility Panel: Data Hub & AI Assistant (Refactored Professional Layout) -->
                <section id="utility-panel" class="mb-14 space-y-10">
                    <div class="grid gap-8 md:gap-10 lg:grid-cols-2">
                        <!-- Data Hub Redesigned -->
                        <section id="data-hub" class="section-card !p-6 md:!p-7 lg:!p-8 relative overflow-hidden" aria-labelledby="data-hub-title">
                            <div class="absolute -top-8 -left-8 w-40 h-40 bg-[var(--brand-gold-light)]/10 rounded-full blur-2xl"></div>
                            <header class="mb-6">
                                <h2 id="data-hub-title" class="text-2xl font-extrabold tracking-tight mb-1">๐ ุจูุงุจุฉ ุงูุจูุงูุงุช (Data Hub)</h2>
                                <p class="text-sm md:text-[15px] leading-relaxed text-[var(--brand-muted-text)]">ุฅุฏุฎุงู ุชูุตููู ูุจูุงูุงุช ุงูููุฏู: ูุชุฑุงุช ุงูุชููุฑุ ุฃุณุนุงุฑ ุงูุบุฑู (ุซูุงุฆูุฉ / ุซูุงุซูุฉ / ุฑุจุงุนูุฉ)ุ ูุตู ุฎุทุท ุงููุฌุจุงุชุ ูุฃุณุนุงุฑ ูู ูุฌุจุฉ. ุจุนุฏ ุงูุฅุถุงูุฉ ุงุถุบุท <strong>ุชุญุฏูุซ ุงููุฎุทุทุงุช</strong> ูุชุฌุฑุจุฉ ุงูููุงุฑูุงุช ุงูููุฑูุฉ. ูุฐู ุงูุจูุงูุงุช ุชุฌุฑูุจูุฉ ูุญููุฉ ูุง ุชุคุซุฑ ุนูู ุงูุชุญูููุงุช ุงูุฃุตููุฉ.</p>
                            </header>
                            <form class="space-y-5" onsubmit="return false;" aria-label="ูููุฐุฌ ุฅุถุงูุฉ ุจูุงูุงุช ููุฏู">
                                <!-- Basic Info & Availability -->
                                <fieldset class="space-y-4" aria-labelledby="basicInfoLegend">
                                    <legend id="basicInfoLegend" class="text-xs font-bold text-gray-500 tracking-wider">ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ & ุงููุฏุฉ</legend>
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-3 items-end">
                                        <input id="newHotelName" type="text" placeholder="ุงุณู ุงูููุฏู" class="md:col-span-1 p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition" />
                                        <select id="newHotelCity" class="p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition">
                                            <option value="Makkah">ููุฉ</option>
                                            <option value="Madinah">ุงููุฏููุฉ</option>
                                        </select>
                                        <input id="newHotelDateFrom" type="date" placeholder="ูู (ูููุงุฏู)" class="p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition" />
                                        <input id="newHotelDateTo" type="date" placeholder="ุฅูู (ูููุงุฏู)" class="p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition" />
                                        <!-- ุญููู ูุฌุฑู (ูุฎููุฉ ุงูุชุฑุงุถูุงู) -->
                                        <div id="hijriInputs" class="md:col-span-4 grid grid-cols-1 md:grid-cols-4 gap-3 mt-2 hidden">
                                            <input id="newHotelDateFromHijri" type="text" placeholder="ูู (ูุฌุฑู) ูุซุงู: 10/02/1447" class="p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition" />
                                            <input id="newHotelDateToHijri" type="text" placeholder="ุฅูู (ูุฌุฑู) ูุซุงู: 15/02/1447" class="p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition" />
                                            <input id="hijriYear" type="number" placeholder="ุงูุณูุฉ ุงููุฌุฑูุฉ" class="p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition" />
                                            <div class="text-xs text-gray-500 flex items-center">ุฃุฏุฎู (ููู/ุดูุฑ/ุณูุฉ)</div>
                                        </div>
                                        <!-- ุดุฑูุท ุงุฎุชูุงุฑ ููุน ุงูุชูููู -->
                                        <div class="col-span-full flex items-center gap-2 pt-1">
                                            <span class="text-[11px] text-gray-500 font-semibold">ุงูุชูููู:</span>
                                            <button type="button" class="cal-mode-btn active" data-calmode="greg" aria-pressed="true">ูููุงุฏู</button>
                                            <button type="button" class="cal-mode-btn" data-calmode="hijri" aria-pressed="false">ูุฌุฑู</button>
                                            <span id="hijriLibWarn" class="hijri-warning">ูู ูุชู ุชุญููู ููุชุจุฉ moment-hijriุ ูู ูุนูู ุงูุชุญููู.</span>
                                        </div>
                                    </div>
                                    <!-- Actions Row -->
                                    <div class="flex flex-wrap gap-3 pt-2">
                                        <button id="addDataBtn" type="button" class="px-6 py-2.5 rounded-lg text-sm font-semibold bg-[var(--brand-dark)] text-white hover:bg-[var(--brand-accent)] focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-[var(--brand-gold-light)] transition">
                                            + ุฅุถุงูุฉ ุงูุจูุงูุงุช
                                        </button>
                                        <button id="refreshChartsBtn" type="button" class="px-6 py-2.5 rounded-lg text-sm font-semibold bg-[var(--brand-gold)] text-white hover:bg-[var(--brand-gold-light)] focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-[var(--brand-gold-light)] transition">
                                            ๐ ุชุญุฏูุซ ุงููุฎุทุทุงุช
                                        </button>
                                    </div>
                                </fieldset>
                                <!-- Room Prices -->
                                <fieldset class="space-y-4" aria-labelledby="roomPricesLegend">
                                    <legend id="roomPricesLegend" class="text-xs font-bold text-gray-500 tracking-wider">ุฃุณุนุงุฑ ุงูุบุฑู (ุฑูุงู)</legend>
                                    <div class="grid grid-cols-3 gap-3">
                                        <input id="newPriceDbl" type="number" min="0" placeholder="ุซูุงุฆูุฉ (BL)" class="p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition" />
                                        <input id="newPriceTpl" type="number" min="0" placeholder="ุซูุงุซูุฉ (PL)" class="p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition" />
                                        <input id="newPriceQuad" type="number" min="0" placeholder="ุฑุจุงุนูุฉ (D)" class="p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition" />
                                    </div>
                                </fieldset>
                                <!-- Meal Plan Descriptions -->
                                <fieldset class="space-y-4" aria-labelledby="mealPlanLegend">
                                    <legend id="mealPlanLegend" class="text-xs font-bold text-gray-500 tracking-wider">ุชูุงุตูู ุงููุฌุจุงุช ูุฎุทุท ุงูุฅุทุนุงู</legend>
                                    <input id="newMealPlanDesc" type="text" placeholder="(ุงุฎุชูุงุฑู)" class="w-full p-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none transition" />
                                </fieldset>
                            </form>
                            <div class="mt-8 grid gap-6">
                                <div class="relative">
                                    <div class="flex items-center justify-between mb-2 flex-wrap gap-2">
                                        <h3 class="text-sm font-bold text-[var(--brand-dark)] mb-1">ูุฎุทุท ููุงุฑูุฉ ููุฑู (ุญุณุจ ููุน ุงูุบุฑูุฉ)</h3>
                                        <div class="inline-flex rounded-lg overflow-hidden border border-gray-300 bg-white shadow-sm" role="group" aria-label="ุชุญุฏูุฏ ููุน ุงูุบุฑูุฉ ูููุฎุทุท">
                                            <button type="button" data-roomtype="quad" class="px-3 py-1.5 text-xs md:text-sm font-semibold hover:bg-gray-100 focus:outline-none focus:ring-1 focus:ring-[var(--brand-gold-light)]">QUAD</button>
                                            <button type="button" data-roomtype="tpl" class="px-3 py-1.5 text-xs md:text-sm font-semibold hover:bg-gray-100 focus:outline-none focus:ring-1 focus:ring-[var(--brand-gold-light)]">TRPL</button>
                                            <button type="button" data-roomtype="dbl" class="px-3 py-1.5 text-xs md:text-sm font-semibold bg-[var(--brand-gold)] text-white focus:outline-none focus:ring-1 focus:ring-[var(--brand-gold-light)]">DBL</button>
                                        </div>
                                    </div>
                                    <div class="rounded-xl border border-gray-200 bg-white/70 backdrop-blur-sm overflow-auto max-h-60 ring-1 ring-gray-900/5">
                                        <table class="min-w-full text-[11px] md:text-xs lg:text-[13px]">
                                            <thead class="bg-gray-50 text-gray-600 sticky top-0">
                                                <tr class="divide-x divide-gray-200 whitespace-nowrap">
                                                    <th class="p-2 font-semibold">ุงูููุฏู</th>
                                                    <th class="p-2 font-semibold">ุงููุฏููุฉ</th>
                                                    <th class="p-2 font-semibold">ูู</th>
                                                    <th class="p-2 font-semibold">ุฅูู</th>
                                                    <th class="p-2 font-semibold">DBL</th>
                                                    <th class="p-2 font-semibold">TRPL</th>
                                                    <th class="p-2 font-semibold">QUAD</th>
                                                    <th class="p-2 font-semibold">ุงููุฌุจุงุช</th>
                                                </tr>
                                            </thead>
                                            <tbody id="newDataTbody" class="divide-y divide-gray-100"></tbody>
                                        </table>
                                    </div>
                                    <p class="mt-2 text-[11px] md:text-xs text-gray-500">* ุญูุธ ูุคูุช ุฏุงุฎู ุงูุฐุงูุฑุฉ (ูู ููุญูุธ ุจุนุฏ ุฅุนุงุฏุฉ ุงูุชุญููู).</p>
                                    <p class="mt-2 text-[10px] text-gray-500">ุงุณุชุฎุฏู ุงูุฃุฒุฑุงุฑ ูุชุบููุฑ ููุน ุงูุบุฑูุฉ ุงููุนุฑูุถ. ูุชู ุงุณุชุฎุฏุงู ุงูุณุนุฑ ุงูุซูุงุฆู ุงููุฏูู ูู DBL ุนูุฏ ุนุฏู ุชููุฑ ุงูุญููู ุงูุฌุฏูุฏุฉ.</p>
                                </div>
                            </div>
                        </section>

                        <!-- AI Assistant Redesigned -->
                        <section id="ai-assistant" class="section-card !p-6 md:!p-7 lg:!p-8 relative overflow-hidden" aria-labelledby="ai-assistant-title">
                            <div class="absolute -bottom-10 -right-10 w-48 h-48 bg-[var(--brand-gold)]/10 rounded-full blur-2xl"></div>
                            <header class="mb-6">
                                <h2 id="ai-assistant-title" class="text-2xl font-extrabold tracking-tight mb-1">๐ค ูุณุงุนุฏ ุงูุฐูุงุก ุงูุงุตุทูุงุนู (ุชุฌุฑูุจู)</h2>
                                <p class="text-sm md:text-[15px] leading-relaxed text-[var(--brand-muted-text)]">ุงุทูุจ ุชุญูููุงู ุณุฑูุนูุง ููุณูู ุฃู ุชูุตูุฉ ููุฏููุฉ ุจูุงุกู ุนูู ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ. ูุชูุนูู ูุงุฌูุฉ ุญููููุฉ ุถุน <code class="bg-gray-100 px-1 rounded text-[11px]">apiUrl</code> ูู ุงูุดููุฑุฉ.</p>
                            </header>
                            <div class="space-y-8">
                                <div class="bg-white/70 backdrop-blur-sm border border-gray-200 rounded-xl p-4 relative">
                                    <h3 class="font-bold text-[var(--brand-dark)] mb-3 text-sm md:text-base">ุชุญููู ุงูุณูู ุงููุฎุชุตุฑ</h3>
                                    <button id="getMarketAnalysisBtn" type="button" class="w-full md:w-auto px-5 py-2.5 rounded-lg text-sm font-semibold bg-[var(--brand-dark)] text-white hover:bg-[var(--brand-accent)] focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-[var(--brand-gold-light)] transition">โก ุงุทูุจ ุงูุชุญููู</button>
                                    <div class="flex items-center gap-3 mt-3">
                                        <div id="marketAnalysisLoader" class="hidden animate-spin h-5 w-5 rounded-full border-2 border-[var(--brand-gold-light)] border-t-transparent"></div>
                                        <div id="marketAnalysisResult" class="flex-1 min-h-[70px] text-xs md:text-sm leading-relaxed text-gray-700"></div>
                                    </div>
                                </div>
                                <div class="bg-white/70 backdrop-blur-sm border border-gray-200 rounded-xl p-4 relative">
                                    <h3 class="font-bold text-[var(--brand-dark)] mb-3 text-sm md:text-base">ุชูุตูุฉ ููุฏููุฉ ูุฎุตุตุฉ</h3>
                                    <div class="space-y-3">
                                        <textarea id="hotelQueryInput" rows="3" class="w-full resize-y p-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-[var(--brand-gold-light)] focus:border-[var(--brand-gold-light)] outline-none text-sm" placeholder="ูุซุงู: ุฃุฑูุฏ ููุฏู 5 ูุฌูู ูู ููุฉ ูุฑูุจ ุจุณุนุฑ ุฃูู ูู 800 ุฑูุงู ููุดูู ุฅูุทุงุฑ"></textarea>
                                        <button id="getHotelRecommendationBtn" type="button" class="w-full md:w-auto px-5 py-2.5 rounded-lg text-sm font-semibold bg-[var(--brand-gold)] text-white hover:bg-[var(--brand-gold-light)] focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-[var(--brand-gold-light)] transition">โจ ุงุญุตู ุนูู ุชูุตูุฉ</button>
                                        <div class="flex items-center gap-3 mt-2">
                                            <div id="hotelRecommendationLoader" class="hidden animate-spin h-5 w-5 rounded-full border-2 border-[var(--brand-gold)] border-t-transparent"></div>
                                            <div id="hotelRecommendationResult" class="flex-1 min-h-[70px] text-xs md:text-sm leading-relaxed text-gray-700"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                    <hr class="border-dashed border-[var(--brand-gold-light)]/40 mt-4" aria-hidden="true" />
                </section>

                <main class="space-y-16" id="main-sections">

            <!-- Makkah Section -->
            <section id="makkah" class="section-card" role="region" aria-labelledby="makkah-title">
                <h2 id="makkah-title" class="text-3xl font-bold text-center mb-8">ุชุญููู ุณูู ููุงุฏู ููุฉ ุงูููุฑูุฉ</h2>
                <p class="text-center mb-12 max-w-4xl mx-auto">
                    ูุชููุฒ ุณูู ููุฉ ุจุชููุนู ุงููุจูุฑุ ุจุฏุกูุง ูู ุงูููุงุฏู ุงููุงุฎุฑุฉ ุงููุทูุฉ ุนูู ุงูุญุฑู ูุตูููุง ุฅูู ุงูุฎูุงุฑุงุช ุงูุงูุชุตุงุฏูุฉ ูู ุงูููุงุทู ุงููุฌุงูุฑุฉ. ูุฐุง ุงููุณู ูุบูุต ูู ุชูุงุตูู ุงูุฃุณุนุงุฑ ููุฎุชูู ุงููุฆุงุช ูุชุทูุฑูุง ุนุจุฑ ุฃุดูุฑ ุงูููุณู.
                </p>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
                    
                    <div class="w-full">
                        <h3 class="text-xl font-bold text-center mb-4">ููุงุฑูุฉ ุชูููุฉ ุงูููุงุฏู ุงููุงุฎุฑุฉ</h3>
                        <p class="text-center text-sm text-gray-500 mb-4">ูุชูุณุท ุณุนุฑ ุงูุบุฑูุฉ ุงูุซูุงุฆูุฉ ูุน ุฅูุทุงุฑ (ุฃุบุณุทุณ - ุณุจุชูุจุฑ 2025)</p>
                        <div class="chart-container">
                            <canvas id="makkahPremiumComparisonChart"></canvas>
                        </div>
                        <p class="text-center mt-4 text-sm text-gray-600">
                           ูุญุชู "ููุฑูููุช ุณุงุนุฉ ููุฉ" ููุฉ ุงููุฑู ุงูุณุนุฑูุ ุจูููุง ุชุธูุฑ ุงูููุงูุณุฉ ุงูุดุฏูุฏุฉ ูู ุงููุฆุฉ ุงูุชุงููุฉ ุจูู "ููููุจูู" ู "ุจูููุงู". ูููุฑ "ุดูุฑุงุชูู ุฌุจู ุงููุนุจุฉ" ู "ุงูุดูุฏุงุก" ููุงุท ุณุนุฑูุฉ ุชูุงูุณูุฉ ููุบุงูุฉ.
                        </p>
                    </div>

                    <div class="w-full">
                        <h3 class="text-xl font-bold text-center mb-4">ููุงุฑูุฉ ุชูููุฉ ุงูููุงุฏู ุงูุงูุชุตุงุฏูุฉ</h3>
                         <p class="text-center text-sm text-gray-500 mb-4">ูุชูุณุท ุณุนุฑ ุงูุบุฑูุฉ ุจุฏูู ูุฌุจุงุช (ุฃุบุณุทุณ - ุณุจุชูุจุฑ 2025)</p>
                        <div class="chart-container">
                            <canvas id="makkahBudgetComparisonChart"></canvas>
                        </div>
                         <p class="text-center mt-4 text-sm text-gray-600">
                           ุชูููู ุงูููุงุฏู ูู ููุงุทู ูุญุจุณ ุงูุฌู ูุฑูุน ุจุฎุด ุนูู ุงูุดุฑูุญุฉ ุงูุงูุชุตุงุฏูุฉุ ูุน ุฃุณุนุงุฑ ุชูุงูุณูุฉ ููุบุงูุฉ ุชูุฏููุง ููุงุฏู ูุซู "ุฃุจุฑุงุฌ ุงููุณูุฉ" ู "ููุงุฒู ุฃุฌูุงุฏ".
                        </p>
                    </div>

                     <div class="w-full">
                        <h3 class="text-xl font-bold text-center mb-4">ุชุทูุฑ ุงูุฃุณุนุงุฑ ุฎูุงู ุงูููุณู (ููุฏู ุงูุดูุฏุงุก)</h3>
                         <p class="text-center text-sm text-gray-500 mb-4">ุชุบูุฑ ูุชูุณุท ุณุนุฑ ุงูุบุฑูุฉ ุงูุซูุงุฆูุฉ ูู ุจุฏุงูุฉ ุงูููุณู ุฅูู ูุชุฑุฉ ุงูุฐุฑูุฉ</p>
                        <div class="chart-container">
                            <canvas id="makkahPriceEvolutionChart"></canvas>
                        </div>
                         <p class="text-center mt-4 text-sm text-gray-600">
                           ููุงุญุธ ุงุฑุชูุงุน ุชุฏุฑูุฌู ูุญุงุฏ ูู ุงูุฃุณุนุงุฑ ูุน ุงูุงูุชุฑุงุจ ูู ููุงูุฉ ุงูุนุงูุ ุญูุซ ุชุตู ุงูุฒูุงุฏุฉ ุฅูู ุฃูุซุฑ ูู ุงูุถุนูุ ููุง ูุคูุฏ ุฃูููุฉ ุงูุญุฌุฒ ุงููุจูุฑ.
                        </p>
                    </div>
                    
                    <div class="w-full">
                        <h3 class="text-xl font-bold text-center mb-4">ุชูุฒูุน ุจุงูุงุช ุงููุฌุจุงุช ูู ุงูุณูู</h3>
                         <p class="text-center text-sm text-gray-500 mb-4">ูุณุจุฉ ุงูุชุดุงุฑ ุฃููุงุน ุจุงูุงุช ุงููุฌุจุงุช ุจูู ุงูููุงุฏู ุงููุนุฑูุถุฉ</p>
                        <div class="chart-container">
                            <canvas id="makkahMealPlanChart"></canvas>
                        </div>
                         <p class="text-center mt-4 text-sm text-gray-600">
                           ุชุชุฑูุฒ ุงูุนุฑูุถ ุจุดูู ูุจูุฑ ุนูู ุจุงูุงุช ุงูุฅูุทุงุฑ (BB) ูุงูุบุฑู ููุท (RO)ุ ููุง ูุชูุญ ูุฑููุฉ ููุดุฑูุงุช ูู ุฅุถุงูุฉ ุฎุฏูุงุช ุงูุฅุนุงุดุฉ ุจุดูู ูุณุชูู.
                        </p>
                    </div>

                </div>
            </section>

            <!-- Madinah Section -->
            <section id="madinah" class="section-card" role="region" aria-labelledby="madinah-title">
                <h2 id="madinah-title" class="text-3xl font-bold text-center mb-8">ุชุญููู ุณูู ููุงุฏู ุงููุฏููุฉ ุงููููุฑุฉ</h2>
                 <p class="text-center mb-12 max-w-4xl mx-auto">
                    ุชุชุฑูุฒ ุงูููุงูุณุฉ ูู ุงููุฏููุฉ ุงููููุฑุฉ ูู ุงูููุทูุฉ ุงููุฑูุฒูุฉ. ุงูุชุญููู ุงูุชุงูู ููุฏู ููุงุฑูุฉ ุดุงููุฉ ููุฃุณุนุงุฑ ููุญูู ุงููููุฉ ุงูุชู ูุญุตู ุนูููุง ุงููุนุชูุฑ ููุงุจู ุงูุณุนุฑ ุงููุฏููุน ุจูุงุกู ุนูู ุงูุฎุฏูุงุช ุงููุถููุฉ.
                </p>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
                    <div class="w-full">
                        <h3 class="text-xl font-bold text-center mb-4">ููุงุฑูุฉ ูุชูุณุท ุชูููุฉ ุงูููุงุฏู ุงูุฑุฆูุณูุฉ</h3>
                        <p class="text-center text-sm text-gray-500 mb-4">ุบุฑูุฉ ุซูุงุฆูุฉ (ุฃุบุณุทุณ - ุณุจุชูุจุฑ 2025)</p>
                        <div class="chart-container">
                            <canvas id="madinahComparisonChart"></canvas>
                        </div>
                        <p class="text-center mt-4 text-sm text-gray-600">
                           ุชุชูุงูุช ุงูุฃุณุนุงุฑ ุจุดูู ูุจูุฑุ ุญูุซ ูุชุตุฏุฑ "ุฏุงุฑ ุงูุฅููุงู ุฅูุชุฑูููุชูููุชุงู" ุงููุงุฆูุฉุ ุจูููุง ุชูุฏู ููุงุฏู ูุซู "ุงูุฃูุตุงุฑ ุฌููุฏู ุชูููุจ" ู "ูููููุฑุฏ ุฏุงุฑ ุงูุฎูุฑ" ุจุฏุงุฆู ุงูุชุตุงุฏูุฉ ููุชุงุฒุฉ ูู ููุจ ุงูููุทูุฉ ุงููุฑูุฒูุฉ.
                        </p>
                    </div>
                     <div class="w-full">
                        <h3 class="text-xl font-bold text-center mb-4">ุชุญููู ุงููููุฉ: ุงูุณุนุฑ ููุงุจู ุงููุฌุจุงุช</h3>
                        <p class="text-center text-sm text-gray-500 mb-4">ููุงุฑูุฉ ุจูู ุชูููุฉ ุงูููุฏู ูููุน ุจุงูุฉ ุงููุฌุจุงุช ุงูููุฏูุฉ</p>
                        <div class="chart-container">
                            <canvas id="madinahValueChart"></canvas>
                        </div>
                        <p class="text-center mt-4 text-sm text-gray-600">
                           ููุธูุฑ ุงูุฑุณู ุงูุจูุงูู ุฃู ุงูููุงุฏู ุงูุชู ุชูุฏู ูุฌุจุงุช ูุงููุฉ (FB) ูุซู "ุณุฌู ุงููุฏููุฉ" ู "ุฅุนูุงุฑ ุฑููุงู" ุชุชุฑูุฒ ูู ูุทุงู ุณุนุฑู ูุชูุณุทุ ููุง ูุฌุนููุง ุฎูุงุฑุงุช ุฐุงุช ูููุฉ ุนุงููุฉ. ุจูููุง ุงูููุงุฏู ุงูุฃูู ุณุนุฑุงู ูุง ุชุดูู ูุฌุจุงุช.
                        </p>
                    </div>
                </div>
            </section>
            
            <!-- Supplier Analysis Section -->
            <section id="suppliers" class="section-card" role="region" aria-labelledby="suppliers-title">
                <h2 id="suppliers-title" class="text-3xl font-bold text-center mb-8">ุชุญููู ุฃุณุนุงุฑ ุงูููุฑุฏูู (ููุฏู ุงูุดูุฏุงุก)</h2>
                <p class="text-center mb-12 max-w-4xl mx-auto">
                    ุชุฎุชูู ุงูุฃุณุนุงุฑ ูููุณ ุงูููุฏู ุจูู ุงูููุฑุฏูู ุงููุฎุชูููู ูุชุชุบูุฑ ุงููุฑููุงุช ูุน ุชุบูุฑ ุงูููุณู. ูุฐุง ุงูุชุญููู ูุณูุท ุงูุถูุก ุนูู ูุฐู ุงููุฑููุงุช ููุณุงุนุฏุชู ูู ุงุฎุชูุงุฑ ุงููุตุฏุฑ ุงูุฃูุถู ุชูููุฉ.
                </p>
                <div class="w-full">
                    <div class="chart-container">
                        <canvas id="supplierComparisonChart"></canvas>
                    </div>
                    <p class="text-center mt-4 text-sm text-gray-600">
                        ูุธูุฑ ุงูุฑุณู ุชุจุงูููุง ูุงุถุญูุง ูู ุงูุฃุณุนุงุฑ ุงูููุฏูุฉ ูู ุงูููุฑุฏูู ูููุณ ุงููุชุฑุฉุ ูุชุชุบูุฑ ูุฐู ุงููุฑููุงุช ูู ูุชุฑุฉ ุงูุฐุฑูุฉุ ููุง ูุคูุฏ ุนูู ุฃูููุฉ ููุงุฑูุฉ ุงูุนุฑูุถ ูุจู ุฅุชูุงู ุงูุญุฌูุฒุงุช ูุถูุงู ุงูุญุตูู ุนูู ุฃูุถู ุณุนุฑ ุชูููุฉ.
                    </p>
                </div>
            </section>

             <!-- Seasonal Peaks Section -->
            <section id="peaks" class="section-card" role="region" aria-labelledby="peaks-title">
                <h2 id="peaks-title" class="text-3xl font-bold text-center mb-8">ุฐุฑูุฉ ุงูููุณู: ุชุญููู ุงุฑุชูุงุน ุงูุฃุณุนุงุฑ</h2>
                <p class="text-center mb-12 max-w-4xl mx-auto">
                    ุชุดูุฏ ุงููุชุฑุฉ ูู ุฃูุงุฎุฑ ุฏูุณูุจุฑ ุฅูู ุฃูุงุฆู ููุงูุฑ ุงุฑุชูุงุนูุง ุญุงุฏูุง ูู ุงูุฃุณุนุงุฑ ุจุณุจุจ ุงูุฅุฌุงุฒุงุช. ูู ุงูุถุฑูุฑู ุฃุฎุฐ ูุฐุง ุงูุงุฑุชูุงุน ูู ุงูุงุนุชุจุงุฑ ุนูุฏ ุงูุชุฎุทูุท ููุจุงูุงุช.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 text-center">
                    <div class="bg-red-50 p-6 rounded-lg">
                        <div class="text-6xl font-extrabold text-red-600">~115%</div>
                        <div class="text-xl text-gray-700 mt-2">ูุชูุณุท ุงูุฒูุงุฏุฉ ูู ุฃุณุนุงุฑ<br>ููุงุฏู ููุฉ ุงููุงุฎุฑุฉ</div>
                    </div>
                     <div class="bg-orange-50 p-6 rounded-lg">
                        <div class="text-6xl font-extrabold text-orange-500">~95%</div>
                        <div class="text-xl text-gray-700 mt-2">ูุชูุณุท ุงูุฒูุงุฏุฉ ูู ุฃุณุนุงุฑ<br>ููุงุฏู ุงููุฏููุฉ ุงููููุฑุฉ</div>
                    </div>
                </div>
            </section>

            <!-- Key Takeaways Section -->
            <section id="takeaways" class="section-card" role="region" aria-labelledby="takeaways-title">
                <h2 id="takeaways-title" class="text-3xl font-bold text-center mb-8">ุงูุฎูุงุตุฉ ูุงูุชูุตูุงุช ุงูุงุณุชุฑุงุชูุฌูุฉ</h2>
                <div class="max-w-4xl mx-auto space-y-6">
                    <div class="bg-blue-50 p-5 rounded-lg border-r-4 border-blue-500">
                        <h3 class="font-bold text-xl text-blue-800">ููุฉ: ุงุณุชุบูุงู ุชููุน ุงูุณูู</h3>
                        <p class="text-blue-700 mt-2">ุงูุณูู ูู ููุฉ ูุชููุน ุจุดูู ูุจูุฑ. **ููุนููุงุก ุงูุจุงุญุซูู ุนู ุงููููุฉ**ุ ูุนุชุจุฑ **ููุฏู ุงูุดูุฏุงุก** ู**ุดูุฑุงุชูู ุฌุจู ุงููุนุจุฉ** ุฎูุงุฑุงุช ููุชุงุฒุฉ ุชุฌูุน ุจูู ุงููุฑุจ ูุงูุณุนุฑ ุงูุฌูุฏ. **ููููุฒุงููุงุช ุงููุญุฏูุฏุฉ**ุ ููุงุฏู ูุซู **ุฃุจุฑุงุฌ ุงููุณูุฉ** ู**ููุงุฒู ุฃุฌูุงุฏ** ุชูุฏู ุฃุณุนุงุฑูุง ูุง ุชูุจู ุงูููุงูุณุฉ.</p>
                    </div>
                    <div class="bg-green-50 p-5 rounded-lg border-r-4 border-green-500">
                        <h3 class="font-bold text-xl text-green-800">ุงููุฏููุฉ: ุงูุชุฑููุฒ ุนูู ุงููููุฉ ุงููุถุงูุฉ</h3>
                        <p class="text-green-700 mt-2">ูู ุงููุฏููุฉุ ุงููููุฉ ูุง ุชูุงุณ ุจุงูุณุนุฑ ููุท. **ููุฏู ุณุฌู ุงููุฏููุฉ** ููุฏู ุฃูุถู ุจุงูุฉ ูุชูุงููุฉ (ุณุนุฑ + ุฅูุทุงุฑ). ุนูุฏ ุงูุชุณูููุ ุฑูุฒ ุนูู ุฃู ุจุงูุงุช ุงูููุงุฏู ุงูุชู ุชุดูู ูุฌุจุงุช ุชููุฑ ุฑุงุญุฉ ูุชูููุฑูุง ุฃูุจุฑ ูููุนุชูุฑ ุนูู ุงููุฏู ุงูุทููู.</p>
                    </div>
                    <div class="bg-purple-50 p-5 rounded-lg border-r-4 border-purple-500">
                        <h3 class="font-bold text-xl text-purple-800">ุฃูููุฉ ููุงุฑูุฉ ุงูููุฑุฏูู</h3>
                        <p class="text-purple-700 mt-2">ููุง ุฃุธูุฑ ุงูุชุญูููุ ูููู ุฃู ุชุตู ูุฑููุงุช ุงูุฃุณุนุงุฑ ูููุณ ุงูููุฏู ุจูู ุงูููุฑุฏูู ุฅูู **15%**. ูู ุงูุถุฑูุฑู ุจูุงุก ุนูุงูุงุช ูุน ููุฑุฏูู ูุชุนุฏุฏูู ูุงูููุงุฑูุฉ ุงูุฏุงุฆูุฉ ููุญุตูู ุนูู ุฃูุถู ุชูููุฉ ููููุฉ.</p>
                    </div>
                    <div class="bg-yellow-50 p-5 rounded-lg border-r-4 border-yellow-500">
                        <h3 class="font-bold text-xl text-yellow-800">ุงูุชุณุนูุฑ ุงูุฏููุงูููู ูุฅุฏุงุฑุฉ ุงูุฐุฑูุฉ</h3>
                        <p class="text-yellow-700 mt-2">ุงูุฃุณุนุงุฑ ุชุฑุชูุน ุจุดูู ุญุงุฏ ูู ููุงูุฉ ุฏูุณูุจุฑ. **ููุตู ุจุดุฏุฉ** ุจุชุทุจูู ุงุณุชุฑุงุชูุฌูุฉ ุชุณุนูุฑ ุฏููุงููููุฉุ ูุน ุฑูุน ุงูุฃุณุนุงุฑ ุจุดูู ูุจูุฑ ููุฐู ุงููุชุฑุฉ ูุชูุฏูู ุนุฑูุถ ุฎุงุตุฉ ููุญุฌูุฒุงุช ุงููุจูุฑุฉ ูุชุฃููู ุงูุบุฑู ูุจู ูุตูู ุงูุฐุฑูุฉ.</p>
                    </div>
                </div>
            </section>

    </main>

    <footer class="text-center mt-16 pt-8 border-t" style="border-color: var(--brand-gold-light);">
            <p style="color: var(--brand-muted-text);">&copy; 2025 ุดุฑูุฉ ุงูุชูุงุตู ุงูุนุงููู. ุฌููุน ุงูุญููู ูุญููุธุฉ.</p>
        </footer>

    </div>

    <a href="#top" id="toTopBtn" aria-label="ุงูุนูุฏุฉ ุฅูู ุงูุฃุนูู" class="bg-gray-800 text-white rounded-full p-3 shadow-lg hover:bg-gray-700">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
        </svg>
    </a>

    <script>
        // --- Professional Enhancements ---
        // 1. Back to Top Button Logic
        const toTopBtn = document.getElementById('toTopBtn');
        window.onscroll = function() {
            if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                toTopBtn.classList.add('show');
            } else {
                toTopBtn.classList.remove('show');
            }
        };

        // 2. Read CSS Variables for Charts
        const computedStyle = getComputedStyle(document.documentElement);
        const brandPalette = {
            gold: computedStyle.getPropertyValue('--brand-gold').trim() || '#b8862f',
            goldLight: computedStyle.getPropertyValue('--brand-gold-light').trim() || '#d4af37',
            dark: computedStyle.getPropertyValue('--brand-dark').trim() || '#3a2d1f',
            accent: computedStyle.getPropertyValue('--brand-accent').trim() || '#8c6c2f',
            mutedText: computedStyle.getPropertyValue('--brand-muted-text').trim() || '#6e6051'
        };
        // --- End of Enhancements ---

        const chartColors = [
            brandPalette.gold,
            brandPalette.goldLight,
            brandPalette.accent,
            '#c89f54', // lighter gold
            '#6b4f2c', // darker brown
            '#e0c89d', // sand
            brandPalette.mutedText
        ];

        // --- Data for Charts and Export ---
        const reportData = {
            makkahPremium: [
                { hotel: 'ููุฏู ุฃูุฌู', cost: 482 }, { hotel: 'ููุฏู ุงูุดูุฏุงุก', cost: 439 },
                { hotel: 'ููููุจูู ูุงุฌุฑ', cost: 785 }, { hotel: 'ุจูููุงู ุฒูุฒู', cost: 780 },
                { hotel: 'ุดูุฑุงุชูู ุฌุจู ุงููุนุจุฉ', cost: 400 }, { hotel: 'ููุฑูููุช ุณุงุนุฉ ููุฉ', cost: 950 }
            ],
            makkahBudget: [
                { hotel: 'ุฃุจุฑุงุฌ ุงููุณูุฉ', cost: 90 }, { hotel: 'ููุงุฒู ุฃุฌูุงุฏ', cost: 123 },
                { hotel: 'ุฅุนูุงุฑ ุงูุฎููู', cost: 185 }, { hotel: 'ููุฏู ููุณุทูู', cost: 175 },
                { hotel: 'ููุงุฑู ุงููุฌุฑุฉ', cost: 150 }, { hotel: 'ุฅููุงู ุจูุฉ', cost: 210 }
            ],
            makkahEvolution: {
                labels: ['ููููู - ุฃุบุณุทุณ', 'ุณุจุชูุจุฑ - ุฃูุชูุจุฑ', 'ุฏูุณูุจุฑ - ููุงูุฑ'],
                datasets: [
                    { hotel: 'ููุฏู ุงูุดูุฏุงุก (BB)', prices: [388, 500, 800] },
                    { hotel: 'ุฅุนูุงุฑ ุฌุฑุงูุฏ (BB)', prices: [280, 340, 490] },
                    { hotel: 'ููุงุฒู ุฃุฌูุงุฏ (RO)', prices: [100, 135, 175] }
                ]
            },
            makkahMealPlans: { 'ุฅูุทุงุฑ ููุท (BB)': 50, 'ุจุฏูู ูุฌุจุงุช (RO)': 40, 'ุดุงูู 3 ูุฌุจุงุช (FB)': 10 },
            madinahHotels: [
                { hotel: 'ุจูููุงู ุฒูุฒู', cost: 550 }, { hotel: 'ูุฑุงูู ุจูุงุฒุง', cost: 525 },
                { hotel: 'ุฏุงุฑ ุงูุฅููุงู ุฅูุชุฑูููุชูููุชุงู', cost: 1108 }, { hotel: 'ููููุจูู ุฃููุงุฑ', cost: 590 },
                { hotel: 'ูุฑููุชูู ุงูุญุงุฑุซูุฉ', cost: 650 }, { hotel: 'ุฏูุฉ ุทูุจุฉ', cost: 547 },
                { hotel: 'ุณุฌู ุงููุฏููุฉ', cost: 455 }, { hotel: 'ุจููุณููุง ููุฑุซ', cost: 650 },
                { hotel: 'ูููููุฑุฏ ุฏุงุฑ ุงูุฎูุฑ', cost: 400 }, { hotel: 'ุงูุฃูุตุงุฑ ุฌููุฏู ุชูููุจ', cost: 378 }
            ],
            madinahValue: [
                { hotel: 'ุณุฌู ุงููุฏููุฉ', price: 455, meal_plan: 'BB' }, { hotel: 'ุฅุนูุงุฑ ุฑููุงู', price: 700, meal_plan: 'FB' },
                { hotel: 'ุจูููุงู ุฒูุฒู', price: 550, meal_plan: 'BB' }, { hotel: 'ูุฑููุชูู ุงูุญุงุฑุซูุฉ', price: 650, meal_plan: 'BB' },
                { hotel: 'ุฏูุฉ ุทูุจุฉ', price: 547, meal_plan: 'RO' }, { hotel: 'ูููููุฑุฏ ุฏุงุฑ ุงูุฎูุฑ', price: 400, meal_plan: 'RO' },
                { hotel: 'ุงูุฃูุตุงุฑ ุฌููุฏู ุชูููุจ', price: 378, meal_plan: 'RO' }, { hotel: 'ูุฑุงูู ุจูุงุฒุง', price: 525, meal_plan: 'RO' },
                { hotel: 'ููููุจูู ุฃููุงุฑ', price: 590, meal_plan: 'BB' }
            ],
            supplierComparison: {
                labels: ['ูุชุฑุฉ ุนุงุฏูุฉ (ุฃุบุณุทุณ - ุณุจุชูุจุฑ)', 'ูุชุฑุฉ ุงูุฐุฑูุฉ (ุฏูุณูุจุฑ - ููุงูุฑ)'],
                datasets: [
                    { supplier: 'ูุงููุฉ ุงูุชูุญูุฏ', prices: [450, 820] },
                    { supplier: 'ููุงู ุงูุถูุงูุฉ', prices: [500, 850] },
                    { supplier: 'ุจุงูู ุฑูุชุด (ูุจุงุดุฑ)', prices: [425, 800] }
                ]
            }
        };


        const tooltipCallback = {
            plugins: {
                tooltip: {
                    callbacks: {
                        title: function(tooltipItems) {
                            const item = tooltipItems[0];
                            let label = item.chart.data.labels[item.dataIndex];
                            if (Array.isArray(label)) { return label.join(' '); }
                            return label;
                        }
                    }
                },
                legend: { labels: { font: { family: 'Cairo', size: 14 } } }
            },
            scales: {
                y: { ticks: { font: { family: 'Cairo' } } },
                x: { ticks: { font: { family: 'Cairo' } } }
            }
        };

        function wrapLabel(label, maxLength = 16) {
            if (label.length <= maxLength) return label;
            const words = label.split(' ');
            const lines = [];
            let currentLine = '';
            words.forEach(word => {
                if ((currentLine + word).length > maxLength) {
                    lines.push(currentLine.trim());
                    currentLine = '';
                }
                currentLine += word + ' ';
            });
            lines.push(currentLine.trim());
            return lines;
        }

        // Makkah Premium Comparison
        new Chart(document.getElementById('makkahPremiumComparisonChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: reportData.makkahPremium.map(d => wrapLabel(d.hotel)),
                datasets: [{ label: 'ูุชูุณุท ุงูุชูููุฉ (ุฑูุงู ุณุนูุฏู)', data: reportData.makkahPremium.map(d => d.cost), backgroundColor: chartColors }]
            },
            options: { ...tooltipCallback, responsive: true, maintainAspectRatio: false }
        });

        // Makkah Budget Comparison
        new Chart(document.getElementById('makkahBudgetComparisonChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: reportData.makkahBudget.map(d => d.hotel),
                datasets: [{ label: 'ูุชูุณุท ุงูุชูููุฉ (ุฑูุงู ุณุนูุฏู)', data: reportData.makkahBudget.map(d => d.cost), backgroundColor: chartColors }]
            },
            options: { ...tooltipCallback, responsive: true, maintainAspectRatio: false, indexAxis: 'y' }
        });

        // Makkah Price Evolution
        new Chart(document.getElementById('makkahPriceEvolutionChart').getContext('2d'), {
            type: 'line',
            data: {
                labels: reportData.makkahEvolution.labels,
                datasets: reportData.makkahEvolution.datasets.map((d, i) => ({
                    label: d.hotel,
                    data: d.prices,
                    borderColor: chartColors[i],
                    backgroundColor: chartColors[i] + '33',
                    fill: true,
                    tension: 0.1
                }))
            },
            options: { ...tooltipCallback, responsive: true, maintainAspectRatio: false }
        });

        // Makkah Meal Plan Composition
        new Chart(document.getElementById('makkahMealPlanChart').getContext('2d'), {
            type: 'doughnut',
            data: {
                labels: Object.keys(reportData.makkahMealPlans),
                datasets: [{ data: Object.values(reportData.makkahMealPlans), backgroundColor: [brandPalette.gold, brandPalette.goldLight, brandPalette.accent], hoverOffset: 4 }]
            },
            options: { ...tooltipCallback, responsive: true, maintainAspectRatio: false }
        });

        // Madinah Comparison
        new Chart(document.getElementById('madinahComparisonChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: reportData.madinahHotels.map(d => wrapLabel(d.hotel)),
                datasets: [{ label: 'ูุชูุณุท ุงูุชูููุฉ (ุฑูุงู ุณุนูุฏู)', data: reportData.madinahHotels.map(d => d.cost), backgroundColor: chartColors }]
            },
            options: { ...tooltipCallback, responsive: true, maintainAspectRatio: false }
        });

        // Madinah Value Scatter
        const mealPlanToValue = { 'RO': 1, 'BB': 2, 'HB': 3, 'FB': 4 };
        new Chart(document.getElementById('madinahValueChart').getContext('2d'), {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'ููุงุฏู ุงููุฏููุฉ',
                    data: reportData.madinahValue.map(d => ({
                        x: d.price,
                        y: mealPlanToValue[d.meal_plan],
                        label: `${d.hotel} (${d.meal_plan})`
                    })),
                    backgroundColor: chartColors, pointRadius: 8, pointHoverRadius: 12
                }]
            },
            options: {
                ...tooltipCallback, responsive: true, maintainAspectRatio: false,
                scales: {
                    x: { title: { display: true, text: 'ูุชูุณุท ุงูุณุนุฑ (ุฑูุงู ุณุนูุฏู)', font: { family: 'Cairo' } } },
                    y: {
                        title: { display: true, text: 'ุจุงูุฉ ุงููุฌุจุงุช', font: { family: 'Cairo' } },
                        ticks: { stepSize: 1, callback: (value) => ['','RO', 'BB', 'HB', 'FB'][value] || '' }
                    }
                },
                plugins: { tooltip: { callbacks: { label: (context) => context.raw.label, title: () => '' } } }
            }
        });

        // Supplier Comparison Chart
        new Chart(document.getElementById('supplierComparisonChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: reportData.supplierComparison.labels,
                datasets: reportData.supplierComparison.datasets.map((d, i) => ({
                    label: d.supplier,
                    data: d.prices,
                    backgroundColor: chartColors[i]
                }))
            },
            options: {
                ...tooltipCallback, responsive: true, maintainAspectRatio: false,
                scales: { y: { beginAtZero: true, title: { display: true, text: 'ุงูุณุนุฑ (ุฑูุงู ุณุนูุฏู)', font: { family: 'Cairo' } } } }
            }
        });

        // Mobile nav toggle (accessibility-friendly)
        (function() {
            const navToggle = document.getElementById('navToggle');
            const navLinks = document.getElementById('navLinks');
            if (!navToggle || !navLinks) return;
            function setToggleIcon(open) {
                if (open) {
                    navToggle.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>';
                } else {
                    navToggle.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>';
                }
            }

            // initialize icon
            setToggleIcon(false);

            navToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                const expanded = navToggle.getAttribute('aria-expanded') === 'true';
                navToggle.setAttribute('aria-expanded', String(!expanded));
                navLinks.classList.toggle('show');
                setToggleIcon(!expanded);
            });
            // Close panel when clicking outside on mobile
            document.addEventListener('click', (e) => {
                if (window.innerWidth > 767) return;
                if (!navLinks.classList.contains('show')) return;
                const target = e.target;
                if (!navLinks.contains(target) && target !== navToggle) {
                    navLinks.classList.remove('show');
                    navToggle.setAttribute('aria-expanded', 'false');
                    setToggleIcon(false);
                }
            });
            // Close nav when resizing to desktop
                window.addEventListener('resize', () => {
                    if (window.innerWidth > 767 && navLinks.classList.contains('show')) {
                        navLinks.classList.remove('show');
                        navToggle.setAttribute('aria-expanded', 'false');
                        setToggleIcon(false);
                    }
                });
            })();

            // Touch-friendly dropdown for export button
            (function() {
                const dropdownButtons = document.querySelectorAll('.dropdown > button');
                dropdownButtons.forEach(btn => {
                    const menu = btn.nextElementSibling;
                    btn.addEventListener('click', e => {
                        e.stopPropagation();
                        menu.classList.toggle('show');
                    });
                });
                // Close dropdowns when clicking outside
                document.addEventListener('click', () => {
                    document.querySelectorAll('.dropdown-content.show').forEach(menu => menu.classList.remove('show'));
                });
            })();

            // Namespaced module: DataHub + AI Assistant (keeps variables local and avoids collisions)
            (function DataHubAIAgent() {
                const palette = ['#005f73', '#0a9396', '#94d2bd', '#e9d8a6', '#ee9b00', '#ca6702'];
                let activeRoomType = 'dbl'; // dbl | tpl | quad
                // Prefer global hotelData if present (non-destructive merge)
                let hotelData = (window.hotelData || []).map(h => ({
                    ...h,
                    price_dbl: h.price_dbl || h.price || null,
                    price_tpl: h.price_tpl || null,
                    price_quad: h.price_quad || null,
                    meal_plan_desc: h.meal_plan_desc || ''
                }));
                let charts = { dataHubChart: null };

                function renderTable(source) {
                    const rows = (source || hotelData) || [];
                    const tbody = document.getElementById('newDataTbody');
                    if (!tbody) return;
                    tbody.innerHTML = '';
                    rows.forEach((r) => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td class="p-2">${r.name || r.hotel || ''}</td>
                            <td class="p-2">${r.city || ''}</td>
                            <td class="p-2">${r.date_from || ''}</td>
                            <td class="p-2">${r.date_to || ''}</td>
                            <td class="p-2">${r.price_dbl ?? r.price ?? ''}</td>
                            <td class="p-2">${r.price_tpl ?? ''}</td>
                            <td class="p-2">${r.price_quad ?? ''}</td>
                            <td class="p-2">${r.meal_plan_desc || ''}</td>`;
                        tbody.appendChild(tr);
                    });
                }

                function destroyCharts() {
                    if (charts.dataHubChart) {
                        charts.dataHubChart.destroy();
                        charts.dataHubChart = null;
                    }
                }

                function buildDatasetByRoomType(roomType) {
                    return (hotelData || []).map(h => {
                        if (roomType === 'tpl') return h.price_tpl ?? null;
                        if (roomType === 'quad') return h.price_quad ?? null;
                        return h.price_dbl ?? h.price ?? null; // default dbl
                    });
                }

                function createCharts() {
                    const ctxEl = document.getElementById('dataHubComparisonChart');
                    if (!ctxEl) return;
                    const ctx = ctxEl.getContext('2d');
                    destroyCharts();
                    const labels = (hotelData || []).map(h => h.name || h.hotel || '');
                    const data = buildDatasetByRoomType(activeRoomType);
                    const labelMap = { dbl: 'ุงูุณุนุฑ ุซูุงุฆู DBL', tpl: 'ุงูุณุนุฑ ุซูุงุซู TRPL', quad: 'ุงูุณุนุฑ ุฑุจุงุนู QUAD' };
                    charts.dataHubChart = new Chart(ctx, {
                        type: 'bar',
                        data: { labels, datasets: [{ label: labelMap[activeRoomType], data, backgroundColor: palette }] },
                        options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
                    });
                }

                function setActiveRoomButton() {
                    document.querySelectorAll('[data-roomtype]').forEach(btn => {
                        if (btn.getAttribute('data-roomtype') === activeRoomType) {
                            btn.classList.add('bg-[var(--brand-gold)]','text-white');
                            btn.classList.remove('hover:bg-gray-100');
                        } else {
                            btn.classList.remove('bg-[var(--brand-gold)]','text-white');
                            btn.classList.add('hover:bg-gray-100');
                        }
                    });
                }

                document.querySelectorAll('[data-roomtype]')?.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const rt = btn.getAttribute('data-roomtype');
                        if (rt && rt !== activeRoomType) {
                            activeRoomType = rt;
                            setActiveRoomButton();
                            if (charts.dataHubChart) createCharts();
                        }
                    });
                });
                setActiveRoomButton();

                // Wire buttons: avoid double-binding if main page already defines handlers/inputs
                const addBtn = document.getElementById('addDataBtn');
                if (addBtn) {
                    addBtn.addEventListener('click', () => {
                        // If the global-form inputs exist (hotelNameInput etc), prefer the main page handler (do nothing here)
                        if (document.getElementById('hotelNameInput') && window.hotelData) {
                            // sync table from global data
                            hotelData = window.hotelData;
                            renderTable(hotelData);
                            return;
                        }

                        const name = (document.getElementById('newHotelName') || {}).value?.trim?.() || '';
                        const city = (document.getElementById('newHotelCity') || {}).value || '';
                        const date_from = (document.getElementById('newHotelDateFrom') || {}).value || '';
                        const date_to = (document.getElementById('newHotelDateTo') || {}).value || '';
                        const price_dbl = (document.getElementById('newPriceDbl') || {}).value ? Number(document.getElementById('newPriceDbl').value) : null;
                        const price_tpl = (document.getElementById('newPriceTpl') || {}).value ? Number(document.getElementById('newPriceTpl').value) : null;
                        const price_quad = (document.getElementById('newPriceQuad') || {}).value ? Number(document.getElementById('newPriceQuad').value) : null;
                        const meal_plan_desc = (document.getElementById('newMealPlanDesc') || {}).value || '';

                        if (!name || (!price_dbl && !price_tpl && !price_quad)) return alert('ุฃุฏุฎู ุงุณู ุงูููุฏู ูุณุนุฑ ูุงุญุฏ ุนูู ุงูุฃูู.');

                        const entry = { name, city, date_from, date_to, price_dbl, price_tpl, price_quad, meal_plan_desc };
                        // push to global if available, otherwise local
                        if (window.hotelData) {
                            window.hotelData.push(entry);
                            hotelData = window.hotelData;
                        } else {
                            hotelData.push(entry);
                        }
                        renderTable(hotelData);
                        // optional: auto-refresh chart if already drawn
                        if (charts.dataHubChart) createCharts();
                    });
                }

                const refreshBtn = document.getElementById('refreshChartsBtn');
                if (refreshBtn) {
                    refreshBtn.addEventListener('click', () => {
                        // If main createCharts exists, call it to refresh the full dashboard
                        if (typeof window.createCharts === 'function') {
                            // ensure global hotelData is synced
                            if (!window.hotelData && hotelData.length) window.hotelData = hotelData;
                            window.createCharts();
                        } else {
                            if ((hotelData || []).length === 0) return alert('ูุง ุชูุฌุฏ ุจูุงูุงุช ูุนุฑุถูุง. ุงูุฑุฌุงุก ุฅุถุงูุฉ ุตู ุจูุงูุงุช ุฃููุงู.');
                            // createCharts(); // This is now removed as there is no dedicated chart canvas anymore.
                        }
                    });
                }

                // Minimal Gemini API caller (placeholder). The API key is intentionally empty.
                async function callGeminiAPI(prompt) {
                    const apiUrl = ''; // โ ุถุน ุนููุงู ุงูุฎุงุฏู/ููุทุฉ ุงูููุงูุฉ ููุง ุฃู ุงุชุฑูู ูุงุฑุบูุง ูุงุฎุชุจุงุฑุงุช ูุญููุฉ
                    if (!apiUrl) return Promise.resolve('ูุถุน ุงูุชุฑุงุถู: ููุชุงุญ/ููุทุฉ ููุงูุฉ Gemini ุบูุฑ ูุถุจูุทุฉ. ุงูุตู ููุชุงุญ API ูู ุงููุชุบูุฑุงุช ูุชุดุบูู ุงูุทูุจุงุช ุงูุญููููุฉ.');
                    try {
                        const resp = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ prompt }) });
                        const json = await resp.json();
                        return json?.result || JSON.stringify(json);
                    } catch (err) {
                        return 'ูุดู ุงูุงุชุตุงู ุจูุฒูุฏ Gemini: ' + err.message;
                    }
                }

                document.getElementById('getMarketAnalysisBtn')?.addEventListener('click', async () => {
                    const out = document.getElementById('marketAnalysisResult');
                    const loader = document.getElementById('marketAnalysisLoader');
                    loader.classList.remove('hidden');
                    out.textContent = '';
                    const res = await callGeminiAPI('ุงุนุทูู ููุฎุตูุง ุณุฑูุนูุง ุนู ุณูู ููุงุฏู ููุฉ ูุงููุฏููุฉ ูุน ุชูุตูุงุช ุชุณุนูุฑ');
                    loader.classList.add('hidden');
                    out.textContent = res;
                });

                document.getElementById('getHotelRecommendationBtn')?.addEventListener('click', async () => {
                    const query = document.getElementById('hotelQueryInput').value.trim();
                    const out = document.getElementById('hotelRecommendationResult');
                    const loader = document.getElementById('hotelRecommendationLoader');
                    if (!query) return alert('ุงูุชุจ ุณุคุงูู ุฃููุงู.');
                    loader.classList.remove('hidden');
                    out.textContent = '';
                    const res = await callGeminiAPI(`ุฃุฌุจ ุจุงูุชุถุงุจ ุนู: ${query}`);
                    loader.classList.add('hidden');
                    out.textContent = res;
                });

                // initialize with a few entries mapped from existing reportData (non-destructive)
                try {
                    if (window.reportData && Array.isArray(window.reportData.makkahPremium)) {
                        window.reportData.makkahPremium.slice(0,3).forEach(r => hotelData.push({ hotel: r.hotel, price_dbl: r.cost, city: 'Makkah' }));
                    }
                } catch (e) { /* ignore */ }
                renderTable();
            })();

        /* Insert Gemini API logic and button wiring (non-destructive) */
        (function GeminiModule(){
	// ุซูุงุจุช: ุถุน ููุชุงุญ API ููุง ุฃู ุงุชุฑูู ูุงุฑุบุงู ุฃุซูุงุก ุงูุชุทููุฑ
	const apiKey = "AIzaSyBPTaGsM4-dr7JnHUHDKJe87MSLtfkaCfw"; // โ ุถุน ุงูููุชุงุญ ููุง
	const apiUrlBase = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent`;
	const hasApiKey = Boolean(apiKey && apiKey.trim().length > 0);

	// ูุชุฌูุจ ุทุจุงุนุฉ ููุณ ุงูุฎุทุฃ ุนุฏุฉ ูุฑุงุช
	let logged403 = false;

	/**
	 * ุฏุงูุฉ ุงูุงุชุตุงู ุจู Gemini ูุน retry ู exponential backoff.
	 * ุฅุฐุง ูู ููุถุจุท apiKey ูุฅููุง ุชูุนูุฏ ุฑุณุงูุฉ ุชูุถูุญูุฉ ุฏูู ุชูููุฐ fetch.
	 */
	async function callGeminiAPI_Gemini(prompt, maxRetries = 3) {
		// ุฅุฐุง ูู ูุชู ุชุนููู apiKeyุ ุฃุนุฏ ุฑุณุงูุฉ ูุงุถุญุฉ ูุจุงุดุฑุฉ (ูุง ุชุญุงูู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช)
		if (!hasApiKey) {
			return "ููุงุญุธุฉ: ูู ูุชู ุฅุนุฏุงุฏ ููุชุงุญ API ูู Gemini. ุถุน ุงููุชุบูุฑ apiKey ุฏุงุฎู ุงูููุฏ ูุชูุนูู ุงูููุงููุงุช ุงูุญููููุฉ.";
		}

		const apiUrl = `${apiUrlBase}?key=${encodeURIComponent(apiKey)}`;
		const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
		const payload = { contents: chatHistory };

		let attempt = 0;
		while (attempt < maxRetries) {
			try {
				const response = await fetch(apiUrl, {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify(payload)
				});

				// ุชุนุงูู ูุฎุตุต ูุน ุญุงูุฉ 403 ูุนุฑุถ ุฑุณุงูุฉ ูููุฏุฉ
				if (response.status === 403) {
					if (!logged403) {
						console.warn('Gemini API returned 403. ุชุญูู ูู ููุชุงุญ API/ุฃุฐููุงุช ุงูุญุณุงุจ.');
						logged403 = true;
					}
					return "ูุดู ุงูุงุชุตุงู: ูุตูู ูุฑููุถ (403). ุชุฃูุฏ ูู ุตุญุฉ ููุชุงุญ API ูุฃุฐููุงุช ูุดุฑูุน Google Cloud.";
				}

				if (!response.ok) {
					throw new Error(`HTTP error! status: ${response.status}`);
				}

				const result = await response.json();

				// ุงุณุชุฎุฑุงุฌ ุงููุต ุจุฃูุงู
				const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;
				if (text) return text;

				throw new Error('Invalid API response structure');
			} catch (error) {
				attempt++;
				if (attempt >= maxRetries) {
					console.error('Gemini API call failed:', error);
					return "ุนุฐุฑุงูุ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ูุญุงููุฉ ุงูุงุชุตุงู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู. ูุฑุฌู ุงููุญุงููุฉ ูุงุญููุง.";
				}
				// exponential backoff
				await new Promise(res => setTimeout(res, Math.pow(2, attempt) * 1000));
			}
		}
	}

	// ุงุนุฑุถ ุงูุฏุงูุฉ ุนุงููููุง ูููุตูู ุงููุฏูู ุฃุซูุงุก ุงูุชุทููุฑ
	window.callGeminiAPI_Gemini = callGeminiAPI_Gemini;

	// ุฑุจุท ุงูุฃุฒุฑุงุฑ (ูุง ุชุบููุฑ ุงูุจููุฉ ุงููุฑุฆูุฉ)
	function wireButtons(){
		const marketBtnEl = document.getElementById('getMarketAnalysisBtn');
		const hotelBtnEl = document.getElementById('getHotelRecommendationBtn');
		if(!marketBtnEl || !hotelBtnEl) return;

		// ุงุณุชูุณุงุฎ ุงูุฃุฒุฑุงุฑ ูุฅุฒุงูุฉ ูุณุชูุนู ุฃุญุฏุงุซ ูุฏููุฉ (non-destructive)
		const marketBtn = marketBtnEl.cloneNode(true);
		marketBtnEl.parentNode.replaceChild(marketBtn, marketBtnEl);

		const hotelBtn = hotelBtnEl.cloneNode(true);
		hotelBtnEl.parentNode.replaceChild(hotelBtn, hotelBtnEl);

		const marketLoader = document.getElementById('marketAnalysisLoader');
		const marketResult = document.getElementById('marketAnalysisResult');

		const hotelLoader = document.getElementById('hotelRecommendationLoader');
		const hotelResult = document.getElementById('hotelRecommendationResult');
		const hotelQueryInput = document.getElementById('hotelQueryInput');

		// ุฒุฑ ุชุญูููู ุงูุณูู
		marketBtn.addEventListener('click', async () => {
			if (marketLoader) marketLoader.classList.remove('hidden');
			marketBtn.disabled = true;
			if (marketResult) marketResult.textContent = '';

			const prompt = `
                ุจุตูุชู ุฎุจูุฑูุง ูู ุชุญููู ุฃุณูุงู ุงูุณูุงุญุฉ ุงูุฏูููุฉุ ูู ุจุชูุฏูู ููุฎุต ุชุญูููู ููุฌุฒ ูุณูู ููุงุฏู ุงูุนูุฑุฉ ูููุณู 1447ูู ุจูุงุกู ุนูู ุงูุจูุงูุงุช ุงููุนุฑูุถุฉ. ุงุฐูุฑ ุฃูู ุงููุฑุต ูุงูุชุญุฏูุงุช ููููุงุก ุงูุณูุฑ.
            `;
			const analysis = await callGeminiAPI_Gemini(prompt);

			if (marketResult) marketResult.textContent = analysis;
			if (marketLoader) marketLoader.classList.add('hidden');
			marketBtn.disabled = false;
		});

		// ุฒุฑ ุทูุจ ุชูุตูุฉ ููุฏููุฉ
		hotelBtn.addEventListener('click', async () => {
			const query = hotelQueryInput ? hotelQueryInput.value : '';
			if (!query || !query.trim()) {
				alert('ุงูุชุจ ุณุคุงูู ุฃููุงู.');
				return;
			}
			if (hotelLoader) hotelLoader.classList.remove('hidden');
			hotelBtn.disabled = true;
			if (hotelResult) hotelResult.textContent = '';

			const hotelDataString = JSON.stringify(window.hotelData || []);

			const prompt = `
                ุฃูุช ุฎุจูุฑ ูู ุญุฌูุฒุงุช ููุงุฏู ุงูุนูุฑุฉ. ุจูุงุกู ุนูู ุทูุจ ุงููุณุชุฎุฏู ุงูุชุงููุ ูุจูุงุกู ุนูู ูุงุฆูุฉ ุงูููุงุฏู ุงููุชููุฑุฉ ูุฐู ููุทุ ูู ุจุชูุฏูู ุชูุตูุฉ ูุฃูุถู ููุฏู ุฃู ููุฏููู ูุน ุฐูุฑ ุงูุณุจุจ.

                ุทูุจ ุงููุณุชุฎุฏู: "${query}"

                ูุงุฆูุฉ ุงูููุงุฏู ุงููุชุงุญุฉ (ุงูุฃุณุนุงุฑ ูุบุฑูุฉ ุซูุงุฆูุฉ): ${hotelDataString}

                ูุฌุจ ุฃู ุชููู ุฅุฌุงุจุชู ุจุงููุบุฉ ุงูุนุฑุจูุฉุ ูุฏูุฏุฉุ ูููุฌุฒุฉ.
            `;
			const recommendation = await callGeminiAPI_Gemini(prompt);

			if (hotelResult) hotelResult.textContent = recommendation;
			if (hotelLoader) hotelLoader.classList.add('hidden');
			hotelBtn.disabled = false;
		});
	}

	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', wireButtons);
	} else {
		wireButtons();
	}
})(); 

// ...existing code...
        // === Hijri / Gregorian Calendar Toggle (ูุญุณูู + fallback ุจุฏูู moment-hijri) ===
        (function calendarModeModule(){
            const modeButtons = document.querySelectorAll('[data-calmode]');
            const gregFrom = document.getElementById('newHotelDateFrom');
            const gregTo = document.getElementById('newHotelDateTo');
            const hijriWrap = document.getElementById('hijriInputs');
            const hijriFrom = document.getElementById('newHotelDateFromHijri');
            const hijriTo = document.getElementById('newHotelDateToHijri');
            const hijriYear = document.getElementById('hijriYear');
            const warn = document.getElementById('hijriLibWarn');
            if(!modeButtons.length) return;

            const momentLoaded = (typeof moment !== 'undefined');
            const momentHijri = momentLoaded && typeof moment().iYear === 'function';
            const hijriDateLoaded = (typeof HijriDate !== 'undefined');
            const hijriSupported = momentHijri || hijriDateLoaded; // true if we can provide user-friendly conversion

            // Fallback: JD-based conversions (from common algorithms)
            function gregorianToJD(y,m,d){
                // Fliegel & Van Flandern
                const a = Math.floor((14 - m)/12);
                const y2 = y + 4800 - a;
                const m2 = m + 12*a - 3;
                return d + Math.floor((153*m2 + 2)/5) + 365*y2 + Math.floor(y2/4) - Math.floor(y2/100) + Math.floor(y2/400) - 32045;
            }
            function jdToGregorian(jd){
                // Fliegel & Van Flandern inverse
                let l = jd + 68569;
                const n = Math.floor((4*l) / 146097);
                l = l - Math.floor((146097*n + 3)/4);
                const i = Math.floor((4000*(l+1)) / 1461001);
                l = l - Math.floor((1461*i)/4) + 31;
                const j = Math.floor((80*l)/2447);
                const day = l - Math.floor((2447*j)/80);
                l = Math.floor(j/11);
                const month = j + 2 - 12*l;
                const year = 100*(n - 49) + i + l;
                // return yyyy-mm-dd
                const mm = month < 10 ? '0'+month : ''+month;
                const dd = day < 10 ? '0'+day : ''+day;
                return `${year}-${mm}-${dd}`;
            }
            function islamicToJD(y,m,d){
                // arithmetic Islamic calendar to JD (tabular)
                return Math.floor((11*y + 3) / 30) + 354*(y-1) + 30*(m-1) - Math.floor((m-1)/2) + d + 1948440 - 385;
            }
            function jdToIslamic(jd){
                // convert JD to Islamic date (arithmetical)
                let l = jd - 1948440 + 10632;
                const n = Math.floor((l - 1) / 10631);
                l = l - 10631*n + 354;
                let j = (Math.floor((10985 - l)/5316))*(Math.floor((50*l)/17719)) + (Math.floor(l/5670))*(Math.floor((43*l)/15238));
                l = l - (Math.floor((30 - j)/15))*(Math.floor((17719*j)/50)) - Math.floor(j/16) + 29;
                const m = Math.floor((24*l)/709);
                const d = l - Math.floor((709*m)/24);
                const y = 30*n + j - 30;
                const mm = m < 10 ? '0'+m : ''+m;
                const dd = d < 10 ? '0'+d : ''+d;
                return `${dd}/${mm}/${y}`;
            }

            // gregorian yyyy-mm-dd -> hijri dd/mm/yyyy
            function gregToHijri_Fallback(gDate){
                if(!gDate) return '';
                const parts = gDate.split('-');
                if(parts.length<3) return '';
                const y = parseInt(parts[0],10), m = parseInt(parts[1],10), d = parseInt(parts[2],10);
                const jd = gregorianToJD(y,m,d);
                return jdToIslamic(jd);
            }

            // hijri string dd/mm[/yyyy] -> greg yyyy-mm-dd
            function hijriToGreg_Fallback(hStr){
                if(!hStr) return null;
                const parts = hStr.trim().split('/');
                if(parts.length < 2) return null;
                let d = parseInt(parts[0],10);
                let m = parseInt(parts[1],10);
                let y = parts[2] ? parseInt(parts[2],10) : (hijriYear && +hijriYear.value ? +hijriYear.value : 1447);
                if(!(d>0 && m>0 && y>0)) return null;
                const jd = islamicToJD(y,m,d);
                return jdToGregorian(jd);
            }

            // UI initialisation: prefer moment-hijri, else hijri-date, else show fallback note
            if (momentHijri) {
                if (warn) warn.style.display = 'none';
                if (hijriYear && !hijriYear.value) hijriYear.value = moment().iYear();
            } else if (hijriDateLoaded) {
                if (warn) { warn.textContent = 'note: moment-hijri ุบูุฑ ูุชุงุญ โ ุณูุชู ุงุณุชุฎุฏุงู hijri-date ููุนุฑุถ.'; warn.style.display = 'inline-block'; }
                try {
                    if (hijriYear && !hijriYear.value) {
                        const hd = new HijriDate(); // today
                       
                        // hijri-date exposes year/month/day properties in many builds
                        hijriYear.value = hd.year ?? hd.yearNumber ?? (new Date().getFullYear() - 579);
                    }
                } catch (e) {
                    if (hijriYear && !hijriYear.value) hijriYear.value = new Date().getFullYear() - 579;
                }
            } else {
                if (warn) { warn.textContent = 'ููุงุญุธุฉ: moment-hijri / hijri-date ุบูุฑ ูุชุงุญุฉุ ุณูุชู ุงุณุชุฎุฏุงู ุชุญููู ุฏุงุฎูู (ุชูุฑูุจู).'; warn.style.display = 'inline-block'; }
                if (hijriYear && !hijriYear.value) hijriYear.value = new Date().getFullYear() - 579;
            }

            function pad(n){ return n<10 ? '0'+n : ''+n; }

            function gregToHijri(gDate){
                // prefer moment-hijri, else hijri-date, else fallback
                if (momentHijri) {
                    const m = moment(gDate,'YYYY-MM-DD');
                    if(!m.isValid()) return '';
                    return `${pad(m.iDate())}/${pad(m.iMonth()+1)}/${m.iYear()}`;
                }
                if (hijriDateLoaded) {
                    try {
                        // use en-GB to get dd/mm/yyyy numeric format, with islamic calendar
                        const hd = new HijriDate(new Date(gDate));
                        const s = hd.toLocaleDateString('en-GB-u-ca-islamic-umalqura'); // e.g. 10/02/1447
                        return s;
                    } catch (e) {
                        return gregToHijri_Fallback(gDate);
                    }
                }
                return gregToHijri_Fallback(gDate);
            }
            function hijriToGreg(hStr){
                // prefer moment-hijri for accurate conversion; if missing use fallback arithmetic conversion
                if (momentHijri) {
                    const parts = hStr.trim().split('/');
                    if(parts.length<2) return null;
                    let [dd,mm,yy] = parts;
                    if(!yy) yy = (hijriYear && hijriYear.value) ? hijriYear.value : moment().iYear();
                    const mObj = moment(`${yy}-${mm}-${dd}`, 'iYYYY-iM-iD');
                    return mObj.isValid() ? mObj.format('YYYY-MM-DD') : null;
                }
                // hijri-date library does not provide a stable direct hijri->greg convert in all builds here,
                // so use the JD fallback which was already implemented for accuracy.
                return hijriToGreg_Fallback(hStr);
            }

            function attachHijriHandler(src, target){
                if(!src || !target) return;
                src.addEventListener('blur', ()=>{
                    const g = hijriToGreg(src.value);
                    if(g) target.value = g;
                });
            }
            attachHijriHandler(hijriFrom, gregFrom);
            attachHijriHandler(hijriTo, gregTo);
            hijriYear && hijriYear.addEventListener('blur', ()=>{
                hijriFrom && hijriFrom.dispatchEvent(new Event('blur'));
                hijriTo && hijriTo.dispatchEvent(new Event('blur'));
            });

            function updateAria(mode){
                modeButtons.forEach(b=>{
                    const active = b.getAttribute('data-calmode')===mode;
                    b.classList.toggle('active', active);
                    b.setAttribute('aria-pressed', active?'true':'false');
                });
            }

            function setActive(mode){
                updateAria(mode);
                if(mode === 'hijri'){
                    hijriWrap.classList.remove('hidden');
                    gregFrom.classList.add('hidden');
                    gregTo.classList.add('hidden');
                    if(hijriSupported){
                        if(gregFrom.value && !hijriFrom.value) hijriFrom.value = gregToHijri(gregFrom.value);
                        if(gregTo.value && !hijriTo.value) hijriTo.value = gregToHijri(gregTo.value);
                    } else {
                        if(gregFrom.value && !hijriFrom.value) hijriFrom.value = gregToHijri_Fallback(gregFrom.value);
                        if(gregTo.value && !hijriTo.value) hijriTo.value = gregToHijri_Fallback(gregTo.value);
                    }
                } else {
                    hijriWrap.classList.add('hidden');
                    gregFrom.classList.remove('hidden');
                    gregTo.classList.remove('hidden');
                    if(hijriFrom.value) hijriFrom.dispatchEvent(new Event('blur'));
                    if(hijriTo.value) hijriTo.dispatchEvent(new Event('blur'));
                }
                localStorage.setItem('calendarMode', mode);
            }

            modeButtons.forEach(btn=>{
                btn.addEventListener('click', ()=>{
                    const mode = btn.getAttribute('data-calmode');
                    if(!mode) return;
                    setActive(mode);
                });
            });

            setActive(localStorage.getItem('calendarMode') || 'greg');
        })();
        // === End Hijri / Gregorian Calendar Toggle ===
    </script>
</body>
</html>